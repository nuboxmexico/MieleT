{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/javascript/components/finance/VisitDetail.jsx\";\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState } from \"react\";\nimport MaterialTable from 'react-data-table-component';\nimport { pendingInvoicing, visitAreCompleted, visitPaidStatus, visitPaidStatusLabel } from \"./utils\";\nimport { invoiceStatus } from \"../../constants/visitService\";\nimport { Box, AccordionDetails, Grid, AccordionSummary, Checkbox, CircularProgress } from '@material-ui/core';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport { useTranslation } from 'react-i18next';\nimport i18next from 'i18next';\n\nfunction VisitDetail(props) {\n  var _this = this;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var service = props.service,\n      selectedVisits = props.selectedVisits,\n      setSelectedVisits = props.setSelectedVisits,\n      selectedService = props.selectedService,\n      setSelectedService = props.setSelectedService;\n  var service_type = service.service_type,\n      created_at = service.last_visit.created_at,\n      requested = service.requested,\n      _service$cost_center = service.cost_center,\n      cost_center = _service$cost_center === void 0 ? {} : _service$cost_center;\n  var visits = service.visits.sort(function (a, b) {\n    return a.visit_number - b.visit_number;\n  });\n\n  var rowSelectCritera = function rowSelectCritera(row) {\n    var _selectedVisits$servi;\n\n    return (_selectedVisits$servi = selectedVisits[service.id]) === null || _selectedVisits$servi === void 0 ? void 0 : _selectedVisits$servi.some(function (visit) {\n      return visit.id === row.id;\n    });\n  };\n\n  var rowDisabledCriteria = function rowDisabledCriteria(row) {\n    return row.invoiced !== 'pending' || !visitAreCompleted(row) || visitPaidStatus(row) === 'unpaid';\n  };\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      selectedRows = _useState2[0],\n      setSelectedRows = _useState2[1];\n\n  function handleRowChange(state) {\n    setSelectedRows(state.selectedRows);\n    var newSelectedVisits = selectedVisits; // Si no existe una visita seleccionada, entonces los eliminaremos de las visitas seleccionadas y los servicios seleccionados\n\n    if (state.selectedRows.length === 0) {\n      var newSelectedService = selectedService.filter(function (selected) {\n        return selected.id !== service.id;\n      });\n      delete newSelectedVisits[service.id];\n      setSelectedVisits(newSelectedVisits);\n      setSelectedService(newSelectedService);\n      return;\n    }\n\n    if (!selectedService.some(function (selected) {\n      return selected.id === service.id;\n    })) {\n      setSelectedService([].concat(_toConsumableArray(selectedService), [service]));\n    } else {}\n\n    newSelectedVisits[service.id] = state.selectedRows;\n    setSelectedVisits(newSelectedVisits);\n  }\n\n  var visitColumns = [{\n    name: i18next.t('globalTables.visitColumns.visitNumber'),\n    selector: 'visit_number',\n    sortable: true\n  }, {\n    name: t('globalTables.visitColumns.paid'),\n    sortable: true,\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 60,\n          columnNumber: 9\n        }\n      }, visitPaidStatusLabel(row));\n    }\n  }, {\n    name: t('globalTables.visitColumns.completed'),\n    sortable: true,\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 9\n        }\n      }, !!row.cancel_from ? t('globalTables.visitColumns.canceled') : visitAreCompleted(row) ? t('globalTables.visitColumns.yes') : t('globalTables.visitColumns.no'));\n    }\n  }, {\n    name: t('globalTables.visitColumns.invoiced'),\n    sortable: true,\n    selector: 'invoiced',\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 9\n        }\n      }, invoiceStatus(row.invoiced) || '-');\n    }\n  }, {\n    name: t('globalTables.visitColumns.daysWithoutInvoicing'),\n    selector: 'days_without_invoicing',\n    sortable: true\n  }];\n  var dateOptions = {\n    day: 'numeric',\n    month: 'numeric',\n    year: 'numeric'\n  };\n  var lastVisitAt = new Date(created_at).toLocaleString('es-ES', dateOptions);\n  return /*#__PURE__*/React.createElement(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(AccordionSummary, {\n    \"aria-controls\": \"panel2a-content\",\n    id: \"paneladditional-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      fontWeight: 'medium'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 9\n    }\n  }, t('services.visits.additionalInfo'))), /*#__PURE__*/React.createElement(AccordionDetails, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"service-price-table-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 11\n    }\n  }, t('services.visits.requestFor')), !service_type && /*#__PURE__*/React.createElement(Skeleton, {\n    height: 21,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 13\n    }\n  }) || /*#__PURE__*/React.createElement(\"span\", {\n    className: \"service-price-table-value service-type-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 13\n    }\n  }, requested)), /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"service-price-table-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }, t('services.visits.lastService')), !created_at && /*#__PURE__*/React.createElement(Skeleton, {\n    height: 21,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 15\n    }\n  }) || /*#__PURE__*/React.createElement(\"span\", {\n    className: \"service-price-table-value service-type-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 15\n    }\n  }, lastVisitAt, \" \")), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    className: \"service-price-table-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 13\n    }\n  }, t('services.visits.costCenter')), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"service-price-table-value service-type-value\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 13\n    }\n  }, (cost_center === null || cost_center === void 0 ? void 0 : cost_center.fullname) || '-')))), /*#__PURE__*/React.createElement(Box, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AccordionSummary, {\n    \"aria-controls\": \"panel2a-content\",\n    id: \"paneladditional-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      fontWeight: 'medium'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 11\n    }\n  }, t('services.visits.associatedVisits'))), /*#__PURE__*/React.createElement(AccordionDetails, {\n    style: {\n      margin: '0 0 60px 0'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(MaterialTable, {\n    noHeader: true,\n    selectableRowsComponentProps: {\n      className: \"product-checkbox\",\n      color: \"primary\"\n    },\n    columns: visitColumns,\n    striped: true,\n    data: visits,\n    selectableRows: true,\n    selectableRowsComponent: Checkbox,\n    highlightOnHover: true,\n    onSelectedRowsChange: handleRowChange,\n    selectableRowSelected: rowSelectCritera,\n    selectableRowDisabled: rowDisabledCriteria,\n    progressComponent: /*#__PURE__*/React.createElement(CircularProgress, {\n      size: 50,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 32\n      }\n    }),\n    noDataComponent: i18next.t('globalText.NoDataComponent'),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 11\n    }\n  }))));\n}\n\nexport default VisitDetail;","map":{"version":3,"sources":["/usr/src/app/javascript/components/finance/VisitDetail.jsx"],"names":["React","useState","MaterialTable","pendingInvoicing","visitAreCompleted","visitPaidStatus","visitPaidStatusLabel","invoiceStatus","Box","AccordionDetails","Grid","AccordionSummary","Checkbox","CircularProgress","Skeleton","useTranslation","i18next","VisitDetail","props","t","service","selectedVisits","setSelectedVisits","selectedService","setSelectedService","service_type","created_at","last_visit","requested","cost_center","visits","sort","a","b","visit_number","rowSelectCritera","row","id","some","visit","rowDisabledCriteria","invoiced","selectedRows","setSelectedRows","handleRowChange","state","newSelectedVisits","length","newSelectedService","filter","selected","visitColumns","name","selector","sortable","cell","cancel_from","dateOptions","day","month","year","lastVisitAt","Date","toLocaleString","fontWeight","fullname","margin","className","color"],"mappings":"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","sourcesContent":["import React, {useState} from \"react\"\nimport MaterialTable from 'react-data-table-component';\nimport {pendingInvoicing, visitAreCompleted, visitPaidStatus, visitPaidStatusLabel} from \"./utils\";\nimport {invoiceStatus} from \"../../constants/visitService\";\nimport {\n  Box,\n  AccordionDetails,\n  Grid,\n  AccordionSummary,\n  Checkbox,\n  CircularProgress,\n} from '@material-ui/core'\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport { useTranslation } from 'react-i18next';\nimport i18next from 'i18next';\n\nfunction VisitDetail(props) {\n  const {t} = useTranslation();\n  const {service, selectedVisits, setSelectedVisits, selectedService, setSelectedService} = props\n  const {service_type, last_visit: {created_at}, requested, cost_center={}} = service\n  const visits = service.visits.sort((a, b) => a.visit_number - b.visit_number)\n  const rowSelectCritera = row => selectedVisits[service.id]?.some(visit => visit.id === row.id)\n  const rowDisabledCriteria = row => row.invoiced !== 'pending' || !visitAreCompleted(row) || (visitPaidStatus(row) === 'unpaid')\n  const [selectedRows, setSelectedRows] = useState([]);\n\n  function handleRowChange(state) {\n    setSelectedRows(state.selectedRows);\n    let newSelectedVisits = selectedVisits\n\n    // Si no existe una visita seleccionada, entonces los eliminaremos de las visitas seleccionadas y los servicios seleccionados\n    if (state.selectedRows.length === 0) {\n      const newSelectedService = selectedService.filter(selected => selected.id !== service.id)\n      delete newSelectedVisits[service.id]\n      setSelectedVisits(newSelectedVisits)\n      setSelectedService(newSelectedService)\n      return\n    }\n\n    if (!selectedService.some(selected => selected.id === service.id)) {\n      setSelectedService([...selectedService, service])\n    } else {\n    }\n\n    newSelectedVisits[service.id] = state.selectedRows\n    setSelectedVisits(newSelectedVisits)\n  }\n\n\n  const visitColumns = [\n    {\n      name: i18next.t('globalTables.visitColumns.visitNumber'),\n      selector: 'visit_number',\n      sortable: true,\n    },\n\n    {\n      name: t('globalTables.visitColumns.paid'),\n      sortable: true,\n      cell: row => (\n        <span>\n        {\n          visitPaidStatusLabel(row)\n        }\n        </span>\n      )\n    },\n\n    {\n      name: t('globalTables.visitColumns.completed'),\n      sortable: true,\n      cell: row => (\n        <span>\n        {\n          !!row.cancel_from ? t('globalTables.visitColumns.canceled') : (visitAreCompleted(row) ? t('globalTables.visitColumns.yes'): t('globalTables.visitColumns.no'))\n        }\n        </span>\n      )\n    },\n\n    {\n      name: t('globalTables.visitColumns.invoiced'),\n      sortable: true,\n      selector: 'invoiced',\n      cell: row => (\n        <span>{invoiceStatus(row.invoiced) || '-'}</span>\n      )\n    },\n\n    {\n      name: t('globalTables.visitColumns.daysWithoutInvoicing'),\n      selector: 'days_without_invoicing',\n      sortable: true,\n    },\n  ]\n  const dateOptions = {day: 'numeric', month: 'numeric', year: 'numeric'}\n  const lastVisitAt = new Date(created_at).toLocaleString('es-ES', dateOptions)\n  return (\n    <Box>\n      <AccordionSummary\n        aria-controls=\"panel2a-content\"\n        id=\"paneladditional-header\"\n      >\n        <span style={{fontWeight: 'medium'}}>\n          {t('services.visits.additionalInfo')}\n        </span>\n      </AccordionSummary>\n\n      <AccordionDetails>\n        <Grid item xs={12} sm={3}>\n          <span className=\"service-price-table-label\">{t('services.visits.requestFor')}</span>\n          {(!service_type) &&\n            <Skeleton height={21} />\n            ||\n            <span className=\"service-price-table-value service-type-value\">{requested}</span>\n          }\n        </Grid>\n\n        <Grid container spacing={3}>\n          <Grid item xs={12} sm={3}>\n            <span className=\"service-price-table-label\">{t('services.visits.lastService')}</span>\n            {(!created_at) &&\n              <Skeleton height={21} />\n              ||\n              <span className=\"service-price-table-value service-type-value\">{lastVisitAt} </span>\n            }\n          </Grid>\n\n          <Grid item xs={12} sm={3}>\n            <span className=\"service-price-table-label\">{t('services.visits.costCenter')}</span>\n            <span className=\"service-price-table-value service-type-value\">{cost_center?.fullname || '-'}</span>\n          </Grid>\n        </Grid>\n      </AccordionDetails>\n      <Box>\n        <AccordionSummary\n          aria-controls=\"panel2a-content\"\n          id=\"paneladditional-header\"\n        >\n          <span style={{fontWeight: 'medium'}}>\n            {t('services.visits.associatedVisits')}\n          </span>\n        </AccordionSummary>\n\n        <AccordionDetails style={{margin: '0 0 60px 0'}}>\n          <MaterialTable\n            noHeader={true}\n            selectableRowsComponentProps={{className: \"product-checkbox\", color: \"primary\"}}\n            columns={visitColumns}\n            striped={true}\n            data={visits}\n            selectableRows\n            selectableRowsComponent={Checkbox}\n            highlightOnHover={true}\n            onSelectedRowsChange={handleRowChange}\n            selectableRowSelected={rowSelectCritera}\n            selectableRowDisabled={rowDisabledCriteria}\n            progressComponent={<CircularProgress size={50} />}\n            noDataComponent={i18next.t('globalText.NoDataComponent')}\n          />\n        </AccordionDetails>\n      </Box>\n    </Box>\n  )\n}\n\nexport default VisitDetail;\n"]},"metadata":{},"sourceType":"module"}