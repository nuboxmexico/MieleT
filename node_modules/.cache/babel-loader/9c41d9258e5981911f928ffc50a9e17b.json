{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/javascript/components/policies/ValidatePaymentPolicyDialog.jsx\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { connect } from \"react-redux\";\nimport { createStructuredSelector } from \"reselect\";\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Link from '@material-ui/core/Link';\nimport { flash_alert } from 'components/App';\nimport { DropzoneArea } from 'material-ui-dropzone';\nimport Grid from '@material-ui/core/Grid';\nimport { createStyles, makeStyles } from '@material-ui/core/styles'; //List\n\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar';\nimport { csrf, headers, headers_www_form, money_format, date_event_format, date_difference_in_hours, api_token, site_url, date_format_without_time } from \"constants/csrf\";\nimport { FileIcon, defaultStyles } from 'react-file-icon';\nimport mime from \"mime-to-extensions\";\nvar DELETE_POLICY = \"DELETE_POLICY\";\nvar DELETED_POLICY = \"DELETED_POLICY\";\n\nfunction validatePayment(customer_id, policy_id, headers) {\n  return function (dispatch) {\n    dispatch({\n      type: DELETE_POLICY\n    });\n    return axios[\"delete\"](\"/api/v1/customers/\".concat(customer_id, \"/policies/\").concat(policy_id), {\n      headers: headers\n    }).then(function (response) {\n      var element = document.getElementById(\"accordeon-policy-\".concat(policy_id));\n      element.parentNode.removeChild(element);\n      flash_alert(\"Eliminado!\", \"Póliza se ha eliminado correctamente\", \"success\");\n      dispatch({\n        type: DELETED_POLICY,\n        response: response\n      });\n    })[\"catch\"](function (e) {\n      flash_alert(\"Error!\", \"No se ha podido eliminar la póliza\", \"danger\");\n      console.log(e);\n    });\n  };\n}\n\n;\n\nfunction ValidatePaymentPolicyDialog(props) {\n  var _this = this;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      open = _useState2[0],\n      setOpen = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      files = _useState4[0],\n      setFiles = _useState4[1];\n\n  var _useState5 = useState(props.policy.payment_resources),\n      _useState6 = _slicedToArray(_useState5, 2),\n      paymentFiles = _useState6[0],\n      setPaymentFiles = _useState6[1]; // Delete image dialog\n\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      openDeleteImageDialog = _React$useState2[0],\n      setOpenDeleteImageDialog = _React$useState2[1];\n\n  var _React$useState3 = React.useState(\"\"),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      currentDeleteImage = _React$useState4[0],\n      setCurrentDeleteImage = _React$useState4[1];\n\n  var useStyles = makeStyles(function (theme) {\n    return createStyles({\n      previewChip: {\n        minWidth: 160,\n        maxWidth: 210\n      },\n      wrapper: {\n        margin: theme.spacing(1),\n        position: 'relative'\n      },\n      buttonProgress: {\n        position: 'absolute',\n        top: '50%',\n        left: '50%',\n        marginTop: -12,\n        marginLeft: -12\n      }\n    });\n  });\n  var classes = useStyles();\n\n  function handleClickOpen(e) {\n    e.preventDefault();\n    setOpen(true);\n  }\n\n  function handleClose(e) {\n    e.preventDefault();\n    setOpen(false);\n  }\n\n  function handleValidate(_x) {\n    return _handleValidate.apply(this, arguments);\n  }\n\n  function _handleValidate() {\n    _handleValidate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var body;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              body = new FormData();\n              body.set('policy_id', props.policy_id);\n              console.log(files);\n              files.forEach(function (file) {\n                body.append('payment_files[]', JSON.stringify(file));\n              });\n              return _context.abrupt(\"return\", axios.post(\"/api/v1/customers/\".concat(props.customer_id, \"/policies/\").concat(props.policy_id, \"/validate_payment\"), body, {\n                headers: headers_www_form\n              }).then(function (response) {\n                console.log(response);\n                setOpen(false);\n                setFiles([]);\n\n                if (response.data.payment_resources.length > 0) {\n                  setPaymentFiles(response.data.payment_resources);\n                  var newpolicy_array = props.policies;\n                  var newpolicy = newpolicy_array.findIndex(function (el) {\n                    return el.id === response.data.id;\n                  });\n                  newpolicy_array[newpolicy] = response.data;\n                  props.setPolicies(newpolicy_array);\n                  flash_alert(\"\", \"Pago validado satisfactoriamente\", \"success\");\n                } else {\n                  flash_alert(\"Error\", \"No se han podido cargar los archivos.\", \"danger\");\n                }\n              })[\"catch\"](function (e) {\n                setOpen(false);\n\n                if (e.response.data) {\n                  console.log(e.response.data);\n\n                  for (var key in e.response.data) {\n                    flash_alert(\"Error\", e.response.data[key], \"danger\");\n                  }\n                }\n              }));\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _handleValidate.apply(this, arguments);\n  }\n\n  function onServiceChangeFiles(_x2) {\n    return _onServiceChangeFiles.apply(this, arguments);\n  }\n\n  function _onServiceChangeFiles() {\n    _onServiceChangeFiles = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e) {\n      var dT;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (e.length > 0) {\n                dT = [];\n                e.forEach( /*#__PURE__*/function () {\n                  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(item) {\n                    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            _context2.next = 2;\n                            return getBase64(item).then(function (encFile) {\n                              dT.push(encFile);\n                              setFiles(dT);\n                            })[\"catch\"](function (error) {\n                              return console.log(\"error\");\n                            });\n\n                          case 2:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  }));\n\n                  return function (_x3) {\n                    return _ref.apply(this, arguments);\n                  };\n                }());\n              }\n\n            case 1:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    return _onServiceChangeFiles.apply(this, arguments);\n  }\n\n  ;\n\n  function getBase64(file) {\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n      reader.readAsDataURL(file);\n\n      reader.onload = function () {\n        return resolve({\n          uri_64: reader.result,\n          name: file.name,\n          mime: file.type\n        });\n      };\n\n      reader.onerror = function (error) {\n        return reject(error);\n      };\n    });\n  }\n\n  var handleClickOpenImageDialog = function handleClickOpenImageDialog(image_id) {\n    setCurrentDeleteImage(image_id);\n    setOpenDeleteImageDialog(true);\n  };\n\n  var handleCloseImageDialog = function handleCloseImageDialog() {\n    setOpenDeleteImageDialog(false);\n  };\n\n  var handleDeleteImage = function handleDeleteImage() {\n    setOpenDeleteImageDialog(false);\n    return axios[\"delete\"](\"/api/v1/file_resources/\".concat(currentDeleteImage), {\n      headers: headers\n    }).then(function (response) {\n      var payment_files_t = paymentFiles.filter(function (file) {\n        return String(file.id) != String(currentDeleteImage);\n      });\n      setPaymentFiles(payment_files_t);\n      flash_alert(\"Eliminado!\", \"El archivo ha sido eliminado correctamente\", \"success\");\n    })[\"catch\"](function (e) {\n      console.log(e);\n      flash_alert(\"Error!\", \"No se ha podido eliminar el archivo\", \"danger\");\n    });\n  };\n\n  function handleMessage(message, type) {\n    if (type == \"error\") {\n      flash_alert(\"\", \"El archivo supera los 10 MB de límite o no cumple con el formato esperado\", \"error\");\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    href: \"#\",\n    id: \"tcustomers_products_\" + props.customer_id,\n    className: \"mdl-navigation__link brand-primary-link customers-pay-policy-link\",\n    onClick: handleClickOpen,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"material-icons\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 170\n    }\n  }, \"money\"), \" Validar pago\"), /*#__PURE__*/React.createElement(Dialog, {\n    open: open,\n    onClose: handleClose,\n    fullWidth: true,\n    maxWidth: \"lg\",\n    \"aria-labelledby\": \"alert-dialog-title\",\n    \"aria-describedby\": \"alert-dialog-description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    id: \"alert-dialog-title\",\n    className: \"policy-validate-payment-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }\n  }, \"Validar pago\"), /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DialogContentText, {\n    id: \"alert-dialog-description\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }\n  }, \"P\\xF3liza N\\xB0 \", props.customer_id, \"-\", props.policy_id, \"?\"), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    className: \"service-price-table-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"service-subtitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 37\n    }\n  }, \"Respaldos\"), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(DropzoneArea, {\n    name: \"services_files\",\n    dropzoneText: \"Arrastre su archivo aqui, o haga click para seleccionarlo\",\n    onChange: onServiceChangeFiles,\n    showPreviews: true,\n    showPreviewsInDropzone: false,\n    useChipsForPreview: true,\n    previewGridProps: {\n      container: {\n        spacing: 1,\n        direction: 'row'\n      }\n    },\n    previewChipProps: {\n      classes: {\n        root: classes.previewChip\n      }\n    },\n    previewText: \"Archivos seleccionados\",\n    filesLimit: 10,\n    showAlerts: false,\n    maxFileSize: 10000000,\n    alertSnackbarProps: {\n      anchorOrigin: {\n        vertical: 'top',\n        horizontal: 'right'\n      }\n    },\n    onAlert: handleMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 41\n    }\n  }))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 6,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    className: \"service-subtitle\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 37\n    }\n  }, \"Archivos subidos\"), /*#__PURE__*/React.createElement(List, {\n    dense: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 37\n    }\n  }, paymentFiles && paymentFiles.map(function (policiyFile) {\n    return /*#__PURE__*/React.createElement(ListItem, {\n      key: \"policiyFile\" + policiyFile.id,\n      button: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 49\n      }\n    }, /*#__PURE__*/React.createElement(ListItemAvatar, {\n      className: \"service-payment-icon\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 53\n      }\n    }, /*#__PURE__*/React.createElement(FileIcon, Object.assign({\n      size: 2,\n      extension: mime.extension(policiyFile.mime)\n    }, defaultStyles[mime.extension(policiyFile.mime)], {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 57\n      }\n    }))), /*#__PURE__*/React.createElement(\"a\", {\n      className: \"new-service-link\",\n      href: policiyFile.resource_url,\n      target: \"_blank\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 53\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      size: \"small\",\n      color: \"primary\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 57\n      }\n    }, policiyFile.name)), /*#__PURE__*/React.createElement(ListItemSecondaryAction, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 53\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      size: \"small\",\n      color: \"primary\",\n      onClick: function onClick() {\n        return handleClickOpenImageDialog(policiyFile.id);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 57\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"material-icons\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 61\n      }\n    }, \"delete\"))));\n  })))))), /*#__PURE__*/React.createElement(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: handleClose,\n    variant: \"outlined\",\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 9\n    }\n  }, \"Cerrar\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: handleValidate,\n    variant: \"contained\",\n    color: \"primary\",\n    autoFocus: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 262,\n      columnNumber: 9\n    }\n  }, \"Validar pago\"))), /*#__PURE__*/React.createElement(Dialog, {\n    open: openDeleteImageDialog,\n    onClose: handleCloseImageDialog,\n    \"aria-labelledby\": \"form-dialog-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(DialogTitle, {\n    id: \"form-dialog-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 269,\n      columnNumber: 13\n    }\n  }, \"Eliminar archivo\"), /*#__PURE__*/React.createElement(DialogContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(DialogContentText, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 17\n    }\n  }, \"\\xBFEsta seguro que desea eliminar este archivo?\")), /*#__PURE__*/React.createElement(DialogActions, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: handleCloseImageDialog,\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 17\n    }\n  }, \"No\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: handleDeleteImage,\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 279,\n      columnNumber: 17\n    }\n  }, \"Si\"))));\n}\n\nvar structuredSelector = createStructuredSelector({\n  customers: function customers(state) {\n    return state.customers;\n  }\n});\nvar mapDispatchToProps = {\n  validatePayment: validatePayment\n};\nexport default connect(structuredSelector, mapDispatchToProps)(ValidatePaymentPolicyDialog);","map":{"version":3,"sources":["/usr/src/app/javascript/components/policies/ValidatePaymentPolicyDialog.jsx"],"names":["React","useState","useEffect","axios","connect","createStructuredSelector","Button","Dialog","DialogActions","DialogContent","DialogContentText","DialogTitle","Link","flash_alert","DropzoneArea","Grid","createStyles","makeStyles","List","ListItem","ListItemIcon","ListItemSecondaryAction","ListItemText","ListItemAvatar","csrf","headers","headers_www_form","money_format","date_event_format","date_difference_in_hours","api_token","site_url","date_format_without_time","FileIcon","defaultStyles","mime","DELETE_POLICY","DELETED_POLICY","validatePayment","customer_id","policy_id","dispatch","type","then","response","element","document","getElementById","parentNode","removeChild","e","console","log","ValidatePaymentPolicyDialog","props","open","setOpen","files","setFiles","policy","payment_resources","paymentFiles","setPaymentFiles","openDeleteImageDialog","setOpenDeleteImageDialog","currentDeleteImage","setCurrentDeleteImage","useStyles","theme","previewChip","minWidth","maxWidth","wrapper","margin","spacing","position","buttonProgress","top","left","marginTop","marginLeft","classes","handleClickOpen","preventDefault","handleClose","handleValidate","body","FormData","set","forEach","file","append","JSON","stringify","post","data","length","newpolicy_array","policies","newpolicy","findIndex","el","id","setPolicies","key","onServiceChangeFiles","dT","item","getBase64","encFile","push","error","Promise","resolve","reject","reader","FileReader","readAsDataURL","onload","uri_64","result","name","onerror","handleClickOpenImageDialog","image_id","handleCloseImageDialog","handleDeleteImage","payment_files_t","filter","String","handleMessage","message","container","direction","root","anchorOrigin","vertical","horizontal","map","policiyFile","extension","resource_url","structuredSelector","customers","state","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { connect } from \"react-redux\"\nimport { createStructuredSelector } from \"reselect\"\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport Link from '@material-ui/core/Link';\nimport { flash_alert } from 'components/App';\nimport { DropzoneArea } from 'material-ui-dropzone';\nimport Grid from '@material-ui/core/Grid';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\n//List\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemSecondaryAction from '@material-ui/core/ListItemSecondaryAction';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport ListItemAvatar from '@material-ui/core/ListItemAvatar';\nimport {csrf, headers, headers_www_form, money_format, date_event_format, date_difference_in_hours, api_token, site_url, date_format_without_time} from \"constants/csrf\"\nimport { FileIcon, defaultStyles } from 'react-file-icon';\nimport mime from \"mime-to-extensions\";\n\nconst DELETE_POLICY = \"DELETE_POLICY\";\nconst DELETED_POLICY = \"DELETED_POLICY\";\n\nfunction validatePayment(customer_id, policy_id, headers) {\n    \n    return (dispatch) => {\n    \tdispatch({type: DELETE_POLICY});\n        return axios.delete(`/api/v1/customers/${customer_id}/policies/${policy_id}`, { headers: headers})\n\t  \t.then(response => {\n            let element = document.getElementById(`accordeon-policy-${policy_id}`);\n            element.parentNode.removeChild(element);\n\t  \t\tflash_alert(\"Eliminado!\", \"Póliza se ha eliminado correctamente\", \"success\")\n            dispatch({type: DELETED_POLICY, response});\n\t  \t})\n\t    .catch(e => {\n\t    \tflash_alert(\"Error!\", \"No se ha podido eliminar la póliza\", \"danger\")\n\t        console.log(e);\n\t\t});\n\t};\n};\n\n\nfunction ValidatePaymentPolicyDialog(props){\n    const [open, setOpen] = useState(false);\n    const [files, setFiles] = useState([]);\n    const [paymentFiles, setPaymentFiles] = useState(props.policy.payment_resources);\n    // Delete image dialog\n    const [openDeleteImageDialog, setOpenDeleteImageDialog] = React.useState(false);\n    const [currentDeleteImage, setCurrentDeleteImage] = React.useState(\"\");\n \n    const useStyles = makeStyles(theme => createStyles({\n\t\tpreviewChip: {\n\t\tminWidth: 160,\n\t\tmaxWidth: 210\n        },\n        wrapper: {\n            margin: theme.spacing(1),\n            position: 'relative',\n        },\n        buttonProgress: {\n            position: 'absolute',\n            top: '50%',\n            left: '50%',\n            marginTop: -12,\n            marginLeft: -12,\n        },\n\t}));\n\t\n    const classes = useStyles();\n    \n\n\tfunction handleClickOpen(e){\n\t\te.preventDefault();\n\t\tsetOpen(true);\n\t}\n\n\tfunction handleClose(e){\n\t\te.preventDefault();\n\t\tsetOpen(false);\n\t}\n\n\tasync function handleValidate(e){\n\t\te.preventDefault();\n\t\t\n        var body = new FormData();\n        body.set('policy_id', props.policy_id);\n        console.log(files)\n        files.forEach((file) => {\n            body.append('payment_files[]', JSON.stringify(file));\n        });\n\n        return axios.post(`/api/v1/customers/${props.customer_id}/policies/${props.policy_id}/validate_payment`, body, { headers: headers_www_form})\n            .then(response => {\n                console.log(response)\n                setOpen(false);\n                setFiles([]); \n                if(response.data.payment_resources.length > 0){\n                    setPaymentFiles(response.data.payment_resources)\n                    let newpolicy_array = props.policies\n                    let newpolicy = newpolicy_array.findIndex((el) => el.id === response.data.id);\n                    newpolicy_array[newpolicy] = response.data;\n                    props.setPolicies(newpolicy_array)\n                    flash_alert(\"\", \"Pago validado satisfactoriamente\" , \"success\")\n                }else{\n                    flash_alert(\"Error\", \"No se han podido cargar los archivos.\", \"danger\")\n                }\n            })\n        .catch(e => {\n            setOpen(false);\n            if(e.response.data){\n                console.log(e.response.data);\n                for (var key in e.response.data) {\n                    flash_alert(\"Error\", e.response.data[key], \"danger\")\n                }\n            }\n        });\n\t}\n\n    async function onServiceChangeFiles(e){\n        if(e.length > 0){\n            const dT = [];\n            e.forEach(async function(item){\n                \n                await getBase64(item)\n                    .then((encFile) => {\n                        dT.push(encFile)\n                        setFiles(dT)\n                    }).catch(error => console.log(\"error\"));\n           \n            });\n            \n        }\n    };\n    \n    function getBase64(file){\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.readAsDataURL(file);\n            reader.onload = () => resolve({\n                uri_64: reader.result,\n                name: file.name,\n                mime: file.type,\n            });\n            reader.onerror = error => reject(error);\n      });\n    }\n\n       \n    const handleClickOpenImageDialog = (image_id) => {\n        setCurrentDeleteImage(image_id)\n        setOpenDeleteImageDialog(true);\n    };\n\n    const handleCloseImageDialog = () => {\n        setOpenDeleteImageDialog(false);\n    };\n\n    const handleDeleteImage = () => {\n        setOpenDeleteImageDialog(false);\n        return axios.delete(`/api/v1/file_resources/${currentDeleteImage}`, { headers: headers})\n            .then(response => {\n                let payment_files_t = paymentFiles.filter(file => String(file.id) != String(currentDeleteImage));\n                setPaymentFiles(payment_files_t);\n                \n                flash_alert(\"Eliminado!\", \"El archivo ha sido eliminado correctamente\", \"success\")\n            })\n            .catch(e => {\n                console.log(e)\n                flash_alert(\"Error!\", \"No se ha podido eliminar el archivo\", \"danger\")\n\n            });\n    };\n     \n    function handleMessage(message,type){\n        if(type == \"error\"){\n            flash_alert(\"\", \"El archivo supera los 10 MB de límite o no cumple con el formato esperado\" , \"error\")\n       }\n    } \n\treturn (\n\t\t<React.Fragment>\n\t\t  <Link href=\"#\" id={\"tcustomers_products_\"+props.customer_id} className=\"mdl-navigation__link brand-primary-link customers-pay-policy-link\" onClick={handleClickOpen}><i className=\"material-icons\">money</i> Validar pago</Link>\n\t\t  <Dialog\n\t\t    open={open}\n\t\t    onClose={handleClose}\n            fullWidth={true}\n        \tmaxWidth={\"lg\"}\n\t\t    aria-labelledby=\"alert-dialog-title\"\n\t\t    aria-describedby=\"alert-dialog-description\"\n\t\t  >\n\t\t    <DialogTitle id=\"alert-dialog-title\" className=\"policy-validate-payment-title\">Validar pago</DialogTitle>\n\t\t    <DialogContent>\n\t\t      <DialogContentText id=\"alert-dialog-description\">\n\t\t        Póliza N° {props.customer_id}-{props.policy_id}?\n\t\t      </DialogContentText>\n\n              <Grid item xs={12} className=\"service-price-table-container\">\n                            \n                            <Grid container spacing={3}>\n                                <Grid item xs={12} sm={6} >\n                                    <p className=\"service-subtitle\">Respaldos</p>\n                                    <Grid item xs={12}>\n                                        <DropzoneArea\n                                            name={\"services_files\"}\n                                            dropzoneText={\"Arrastre su archivo aqui, o haga click para seleccionarlo\"}\n                                            onChange={onServiceChangeFiles}\n                                            showPreviews={true}\n                                            showPreviewsInDropzone={false}\n                                            useChipsForPreview\n                                            previewGridProps={{container: { spacing: 1, direction: 'row' }}}\n                                            previewChipProps={{classes: { root: classes.previewChip } }}\n                                            previewText=\"Archivos seleccionados\"\n                                            filesLimit={10}\n                                            showAlerts={false}\n                                            maxFileSize={10000000}\n                                            alertSnackbarProps={{anchorOrigin: { vertical: 'top', horizontal: 'right' }}}\n                                            onAlert={handleMessage}\n                                        />\n                                    </Grid>\n                                </Grid>\n                                <Grid item xs={12} sm={6} >\n                                    <p className=\"service-subtitle\">Archivos subidos</p>\n                                    <List dense>\n                                        {paymentFiles && paymentFiles.map((policiyFile) => {\n                                            return (\n                                                <ListItem key={\"policiyFile\"+policiyFile.id} button>\n                                                    <ListItemAvatar className=\"service-payment-icon\">\n                                                        <FileIcon\n                                                                size={2}\n                                                                extension={mime.extension(policiyFile.mime)}\n                                                                {...defaultStyles[mime.extension(policiyFile.mime)]}\n                                                            />  \n                                                    </ListItemAvatar>\n                                                    <a className=\"new-service-link\" href={policiyFile.resource_url} target=\"_blank\">\n                                                        <Button size=\"small\" color=\"primary\">\n                                                            {policiyFile.name}\n                                                        </Button>\n                                                    </a>\n                                                    <ListItemSecondaryAction>\n                                                        <Button size=\"small\" color=\"primary\" onClick={() => handleClickOpenImageDialog(policiyFile.id)}>\n                                                            <i className=\"material-icons\">delete</i>\n                                                        </Button>\n                                                    </ListItemSecondaryAction>\n                                                </ListItem>            \n                                            );\n                                        })}\n                                    </List>\n                                </Grid>\n                            </Grid>\n                        </Grid>\n\n\t\t    </DialogContent>\n\t\t    <DialogActions>\n\t\t      <Button onClick={handleClose} variant=\"outlined\" color=\"primary\">\n\t\t        Cerrar\n\t\t      </Button>\n\t\t      <Button onClick={handleValidate} variant=\"contained\" color=\"primary\" autoFocus>\n                Validar pago\n\t\t      </Button>\n\t\t    </DialogActions>\n\t\t  </Dialog>\n\n          <Dialog open={openDeleteImageDialog} onClose={handleCloseImageDialog} aria-labelledby=\"form-dialog-title\">\n            <DialogTitle id=\"form-dialog-title\">Eliminar archivo</DialogTitle>\n            <DialogContent>\n                <DialogContentText>\n                    ¿Esta seguro que desea eliminar este archivo?\n                </DialogContentText>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={handleCloseImageDialog} color=\"primary\">\n                    No\n                </Button>\n                <Button onClick={handleDeleteImage} color=\"primary\">\n                    Si\n                </Button>\n            </DialogActions>\n          </Dialog>\n\t\t</React.Fragment>\n\t);\n  \n}\n\nconst structuredSelector = createStructuredSelector({\n  customers: state => state.customers\n});\nconst mapDispatchToProps = {validatePayment};\n\nexport default connect(structuredSelector, mapDispatchToProps)(ValidatePaymentPolicyDialog)\n"]},"metadata":{},"sourceType":"module"}