{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/javascript/components/policies/EditPolicy.jsx\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\nimport axios from 'axios';\nimport { Link } from 'react-router-dom';\nimport { Redirect } from \"react-router-dom\";\nimport { connect } from \"react-redux\";\nimport { createStructuredSelector } from \"reselect\";\nimport { flash_alert } from 'components/App';\nimport ShowCustomer from \"components/customers/ShowCustomer\";\nimport PolicyForm from \"components/policies/PolicyForm\";\nimport Paper from '@material-ui/core/Paper';\nimport Grid from '@material-ui/core/Grid';\n\nfunction EditPolicy(props) {\n  // Customer Info\n  var _useState = useState(\"\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      customer_id = _useState2[0],\n      setCustomerId = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      customerNames = _useState4[0],\n      setCustomerFirstname = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      _useState6 = _slicedToArray(_useState5, 2),\n      customerLastname = _useState6[0],\n      setCustomerLastname = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      customerSurname = _useState8[0],\n      setCustomerSurname = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      customer = _useState10[0],\n      setCustomer = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      redirect = _useState12[0],\n      setRedirect = _useState12[1];\n\n  var _useState13 = useState(\"MX\"),\n      _useState14 = _slicedToArray(_useState13, 2),\n      country = _useState14[0],\n      setCountry = _useState14[1]; // Policy info\n\n\n  var _useState15 = useState(\"\"),\n      _useState16 = _slicedToArray(_useState15, 2),\n      policy_id = _useState16[0],\n      setPolicyId = _useState16[1];\n\n  var _useState17 = useState(0.0),\n      _useState18 = _slicedToArray(_useState17, 2),\n      laborPrice = _useState18[0],\n      setlaborPrice = _useState18[1];\n\n  var _useState19 = useState(0.0),\n      _useState20 = _slicedToArray(_useState19, 2),\n      itemsPrice = _useState20[0],\n      setItemsPrice = _useState20[1];\n\n  var _useState21 = useState(0.0),\n      _useState22 = _slicedToArray(_useState21, 2),\n      viaticPrice = _useState22[0],\n      setViaticPrice = _useState22[1];\n\n  var _useState23 = useState(0.0),\n      _useState24 = _slicedToArray(_useState23, 2),\n      ivaAmount = _useState24[0],\n      setIVAAmount = _useState24[1];\n\n  var _useState25 = useState(0.0),\n      _useState26 = _slicedToArray(_useState25, 2),\n      subtotalPrice = _useState26[0],\n      setSubTotalPrice = _useState26[1];\n\n  var _useState27 = useState(0.0),\n      _useState28 = _slicedToArray(_useState27, 2),\n      totalPrice = _useState28[0],\n      setTotalPrice = _useState28[1];\n\n  var _useState29 = useState([]),\n      _useState30 = _slicedToArray(_useState29, 2),\n      policyItemsRows = _useState30[0],\n      setPolicyItemsRows = _useState30[1];\n\n  var _React$useState = React.useState(\"principal\"),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      checkedAddress = _React$useState2[0],\n      setCheckedAddress = _React$useState2[1]; // Products\n\n\n  var _useState31 = useState([]),\n      _useState32 = _slicedToArray(_useState31, 2),\n      products = _useState32[0],\n      setProducts = _useState32[1];\n\n  var _useState33 = useState([]),\n      _useState34 = _slicedToArray(_useState33, 2),\n      selectedProductRows = _useState34[0],\n      setSelectedProductRows = _useState34[1];\n\n  var _useState35 = useState(0.16),\n      _useState36 = _slicedToArray(_useState35, 2),\n      countryIVA = _useState36[0],\n      setCountryIVA = _useState36[1];\n\n  useEffect(function () {\n    function fetchData() {\n      return _fetchData.apply(this, arguments);\n    }\n\n    function _fetchData() {\n      _fetchData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var userId, policy_id;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                userId = props.match.params.id;\n                policy_id = props.match.params.id_policy;\n                setPolicyId(policy_id);\n                return _context.abrupt(\"return\", fetch(\"/api/v1/customers/\".concat(userId)).then(function (response) {\n                  return response.json();\n                }).then(function (json) {\n                  setCustomerId(json.data.id);\n                  setCustomerFirstname(json.data.names);\n                  setCustomerLastname(json.data.lastname);\n                  setCustomerSurname(json.data.surname);\n\n                  if (json.data.country != null) {\n                    setCountry(json.data.country.iso);\n                    setCountryIVA(json.data.country.iva);\n                  }\n\n                  setProducts(json.data.customer_products);\n\n                  if (json.data.policies.length > 0) {\n                    var current_policy = json.data.policies.find(function (policy) {\n                      return String(policy.id) === policy_id;\n                    });\n\n                    if (current_policy !== undefined) {\n                      setlaborPrice(current_policy.labor_price);\n                      setItemsPrice(current_policy.items_price);\n                      setViaticPrice(current_policy.viatic_price);\n                      setTotalPrice(current_policy.total_price);\n                      setCheckedAddress(current_policy.address_assinged);\n                      setSelectedProductRows(current_policy.customer_products);\n                    }\n                  }\n\n                  setCustomer(json.data);\n                })[\"catch\"](function (error) {\n                  return console.log(error);\n                }));\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _fetchData.apply(this, arguments);\n    }\n\n    fetchData();\n  }, []);\n\n  function handleSubmit(event) {\n    event.preventDefault();\n    var body = new FormData();\n    body.set('policy_id', policy_id);\n    body.set('customer_id', customer_id);\n    body.set('customer_products_id', selectedProductRows.map(function (product_row) {\n      return product_row.id;\n    }));\n    body.set('address_assinged', checkedAddress);\n    body.set('labor_price', laborPrice);\n    body.set('items_price', itemsPrice);\n    body.set('viatic_price', viaticPrice);\n    body.set('iva_amount', ivaAmount);\n    body.set('subtotal_price', subtotalPrice);\n    body.set('total_price', totalPrice);\n    return axios.patch(\"/api/v1/customers/\".concat(customer_id, \"/policies/\").concat(policy_id, \"/update_policy\"), body, {\n      headers: props.headers\n    }).then(function (response) {\n      flash_alert(\"Creado\", \"La póliza se ha actualizado satisfactoriamente\", \"success\");\n      setRedirect(true);\n    })[\"catch\"](function (e) {\n      console.log(e.response.data);\n\n      if (e.response.data) {\n        for (var key in e.response.data) {\n          flash_alert(\"Error\", e.response.data[key], \"danger\");\n        }\n      }\n    });\n  }\n\n  var redirect_check = [];\n\n  if (redirect) {\n    redirect_check.push( /*#__PURE__*/React.createElement(Redirect, {\n      key: \"redirect-to-customers\",\n      to: \"/customers/\".concat(customer_id, \"/show\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 4\n      }\n    }, /*#__PURE__*/React.createElement(ShowCustomer, {\n      setLoading: props.setLoading,\n      headers: props.headers,\n      match: props.match,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 80\n      }\n    })));\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 5\n    }\n  }, redirect_check, /*#__PURE__*/React.createElement(Paper, {\n    className: \"custom-paper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    className: \"mdl-navigation__link  back-link customers-edit-link\",\n    to: \"/customers/\".concat(customer_id, \"/show\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"material-icons\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 23\n    }\n  }, \"keyboard_arrow_left\"), \" Volver\"), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 27\n    }\n  }, \"Editar p\\xF3liza de mantenimiento de \", customerNames, \" \", customerLastname, \" \", customerSurname))), /*#__PURE__*/React.createElement(PolicyForm // Customer\n  , {\n    customer_id: customer_id,\n    country: country,\n    setCustomerId: setCustomerId,\n    handleSubmit: handleSubmit,\n    customer: customer,\n    setCustomer: setCustomer,\n    checkedAddress: checkedAddress,\n    setCheckedAddress: setCheckedAddress // Products\n    ,\n    products: products,\n    setProducts: setProducts,\n    selectedProductRows: selectedProductRows,\n    setSelectedProductRows: setSelectedProductRows,\n    policyItemsRows: policyItemsRows,\n    setPolicyItemsRows: setPolicyItemsRows // Prices\n    ,\n    countryIVA: countryIVA,\n    laborPrice: laborPrice,\n    setlaborPrice: setlaborPrice,\n    itemsPrice: itemsPrice,\n    setItemsPrice: setItemsPrice,\n    viaticPrice: viaticPrice,\n    setViaticPrice: setViaticPrice,\n    ivaAmount: ivaAmount,\n    setIVAAmount: setIVAAmount,\n    subtotalPrice: subtotalPrice,\n    setSubTotalPrice: setSubTotalPrice,\n    totalPrice: totalPrice,\n    setTotalPrice: setTotalPrice,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 17\n    }\n  })));\n}\n\nvar structuredSelector = createStructuredSelector({});\nvar mapDispatchToProps = {};\nexport default connect(structuredSelector, mapDispatchToProps)(EditPolicy);","map":{"version":3,"sources":["/usr/src/app/javascript/components/policies/EditPolicy.jsx"],"names":["React","useState","useEffect","ReactDOM","axios","Link","Redirect","connect","createStructuredSelector","flash_alert","ShowCustomer","PolicyForm","Paper","Grid","EditPolicy","props","customer_id","setCustomerId","customerNames","setCustomerFirstname","customerLastname","setCustomerLastname","customerSurname","setCustomerSurname","customer","setCustomer","redirect","setRedirect","country","setCountry","policy_id","setPolicyId","laborPrice","setlaborPrice","itemsPrice","setItemsPrice","viaticPrice","setViaticPrice","ivaAmount","setIVAAmount","subtotalPrice","setSubTotalPrice","totalPrice","setTotalPrice","policyItemsRows","setPolicyItemsRows","checkedAddress","setCheckedAddress","products","setProducts","selectedProductRows","setSelectedProductRows","countryIVA","setCountryIVA","fetchData","userId","match","params","id","id_policy","fetch","then","response","json","data","names","lastname","surname","iso","iva","customer_products","policies","length","current_policy","find","policy","String","undefined","labor_price","items_price","viatic_price","total_price","address_assinged","error","console","log","handleSubmit","event","preventDefault","body","FormData","set","map","product_row","patch","headers","e","key","redirect_check","push","setLoading","structuredSelector","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport ReactDOM from 'react-dom'\nimport axios from 'axios';\nimport { Link } from 'react-router-dom'\nimport { Redirect } from \"react-router-dom\";\nimport { connect } from \"react-redux\"\nimport { createStructuredSelector } from \"reselect\"\nimport { flash_alert } from 'components/App';\nimport ShowCustomer from \"components/customers/ShowCustomer\";\nimport PolicyForm from \"components/policies/PolicyForm\";\nimport Paper from '@material-ui/core/Paper';\nimport Grid from '@material-ui/core/Grid';\n\nfunction EditPolicy(props){\n\n    \n    // Customer Info\n    const [customer_id, setCustomerId] = useState(\"\");\n    const [customerNames, setCustomerFirstname] = useState(\"\");\n    const [customerLastname, setCustomerLastname] = useState(\"\");\n    const [customerSurname, setCustomerSurname] = useState(\"\");\n    const [customer, setCustomer] = useState(\"\");\n    \n    const [redirect, setRedirect] = useState(false);\n    const [country, setCountry] = useState(\"MX\");\n    \n    // Policy info\n    const [policy_id, setPolicyId] = useState(\"\");\n    const [laborPrice, setlaborPrice] = useState(0.0);\n    const [itemsPrice, setItemsPrice] = useState(0.0);\n    const [viaticPrice, setViaticPrice] = useState(0.0);\n    const [ivaAmount, setIVAAmount] = useState(0.0);\n    const [subtotalPrice, setSubTotalPrice] = useState(0.0);\n    const [totalPrice, setTotalPrice] = useState(0.0);\n    const [policyItemsRows, setPolicyItemsRows] = useState([]);\n    const [checkedAddress, setCheckedAddress] = React.useState(\"principal\");\n    // Products\n    const [products, setProducts] = useState([]);\n    const [selectedProductRows, setSelectedProductRows] = useState([]);\n    const [countryIVA, setCountryIVA] = useState(0.16);\n    useEffect(() => {\n        async function fetchData() {\n            let userId = props.match.params.id;\n            let policy_id = props.match.params.id_policy;\n            setPolicyId(policy_id)\n            return fetch(`/api/v1/customers/${userId}`)\n                    .then(response => response.json())\n                    .then(json => {\n                        \n                        setCustomerId(json.data.id)\n                        setCustomerFirstname(json.data.names)\n                        setCustomerLastname(json.data.lastname)\n                        setCustomerSurname(json.data.surname)\n                        if(json.data.country != null){\n                            setCountry(json.data.country.iso)\n                            setCountryIVA(json.data.country.iva)\n                        }\n                        setProducts(json.data.customer_products)\n                        if(json.data.policies.length > 0){\n                            var current_policy = json.data.policies.find(policy => String(policy.id) === policy_id);\n                            if (current_policy !== undefined){\n                                setlaborPrice(current_policy.labor_price)\n                                setItemsPrice(current_policy.items_price)\n                                setViaticPrice(current_policy.viatic_price)\n                                setTotalPrice(current_policy.total_price)\n                                setCheckedAddress(current_policy.address_assinged)\n                                setSelectedProductRows(current_policy.customer_products);\n                           }\n                        }\n                        setCustomer(json.data)\n\n\n                    })\n                    .catch(error => console.log(error));\n            }\n            fetchData();\n    }, []);\n\n    function handleSubmit(event) {\n        event.preventDefault();\n        var body = new FormData();\n        body.set('policy_id', policy_id);\n        body.set('customer_id', customer_id);\n        body.set('customer_products_id', selectedProductRows.map(function(product_row) {\n            return (product_row.id);\n        }));\n        body.set('address_assinged', checkedAddress);\n        body.set('labor_price', laborPrice);\n        body.set('items_price', itemsPrice);\n        body.set('viatic_price', viaticPrice);\n        body.set('iva_amount', ivaAmount);\n        body.set('subtotal_price', subtotalPrice);\n        body.set('total_price', totalPrice);\n        return axios.patch(`/api/v1/customers/${customer_id}/policies/${policy_id}/update_policy`, body, { headers: props.headers})\n            .then(response => {\n                flash_alert(\"Creado\", \"La póliza se ha actualizado satisfactoriamente\", \"success\")\n                setRedirect(true);\n            })\n        .catch(e => {\n            console.log(e.response.data);\n            if(e.response.data){\n                for (var key in e.response.data) {\n                    flash_alert(\"Error\", e.response.data[key], \"danger\")\n                }\n            }\n        });\n    }\n\n    let redirect_check = []\n\tif (redirect){\n\t\tredirect_check.push(\n\t\t\t<Redirect key=\"redirect-to-customers\" to={`/customers/${customer_id}/show`}><ShowCustomer setLoading={props.setLoading} headers={props.headers} match={props.match} /></Redirect>\n\t\t);\n\t}\n\n\n  \treturn (\n  \t\t<React.Fragment>\n            {redirect_check}\n            \n            <Paper className=\"custom-paper\">\n                <Grid container spacing={3}>\n                    <Link className=\"mdl-navigation__link  back-link customers-edit-link\" to={`/customers/${customer_id}/show`}>\n                      <i className=\"material-icons\">keyboard_arrow_left</i> Volver\n                    </Link>\n                    <Grid item xs={12}>\n                          <h1>Editar póliza de mantenimiento de {customerNames} {customerLastname} {customerSurname}</h1>\n                    </Grid>\n                </Grid>\n                <PolicyForm\n                    // Customer\n                    customer_id={customer_id}\n                    country={country}\n                    setCustomerId={setCustomerId}\n                    handleSubmit={handleSubmit}\n                    customer={customer}\n                    setCustomer={setCustomer}\n                    checkedAddress={checkedAddress}\n                    setCheckedAddress={setCheckedAddress}\n                    // Products\n                    products={products}\n                    setProducts={setProducts}\n                    selectedProductRows={selectedProductRows}\n                    setSelectedProductRows={setSelectedProductRows}\n                    policyItemsRows={policyItemsRows}\n                    setPolicyItemsRows={setPolicyItemsRows}\n                    // Prices\n                    countryIVA={countryIVA}\n                    laborPrice={laborPrice}\n                    setlaborPrice={setlaborPrice}\n                    itemsPrice={itemsPrice}\n                    setItemsPrice={setItemsPrice}\n                    viaticPrice={viaticPrice}\n                    setViaticPrice={setViaticPrice}\n                    ivaAmount={ivaAmount}\n                    setIVAAmount={setIVAAmount}\n                    subtotalPrice={subtotalPrice}\n                    setSubTotalPrice={setSubTotalPrice}\n                    totalPrice={totalPrice}\n                    setTotalPrice={setTotalPrice}\n                />\n            </Paper>\n\t\t</React.Fragment>\n\t);\n  \n}\n\nconst structuredSelector = createStructuredSelector({});\nconst mapDispatchToProps = {};\nexport default connect(structuredSelector, mapDispatchToProps)(EditPolicy)\n"]},"metadata":{},"sourceType":"module"}