{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/javascript/components/services/visits/ServiceVisits.jsx\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { connect } from \"react-redux\";\nimport { createStructuredSelector } from \"reselect\";\nimport Grid from '@material-ui/core/Grid';\nimport { flash_alert } from 'components/App';\nimport { csrf, headers, money_format, date_format, date_event_format, date_difference_in_hours } from \"constants/csrf\";\nimport pluralize from 'pluralize';\nimport Accordion from '@material-ui/core/Accordion';\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\nimport Typography from '@material-ui/core/Typography';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Link } from 'react-router-dom';\nimport NewScheduleDialog from \"components/services/NewScheduleDialog\";\nimport Button from '@material-ui/core/Button';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport VisitTabs from \"components/services/visits/VisitTabs\";\nimport StartVisitBtn from \"components/services/visits/StartVisitBtn\";\nimport CanceVisitDialog from \"components/services/visits/CanceVisitDialog\";\nimport VisitTechnicians from \"components/services/visits/VisitTechnicians\";\nimport Chip from '@material-ui/core/Chip';\nimport { b2b_site_url } from '../../../constants/csrf';\nimport { fetchPaymentVisit } from 'api/visit';\nimport { useTranslation } from \"react-i18next\";\nvar useStyles = makeStyles(function (theme) {\n  var _heading;\n\n  return {\n    root: {\n      '& > *': {\n        margin: theme.spacing(1)\n      }\n    },\n    heading: (_heading = {\n      fontSize: theme.typography.pxToRem(15),\n      flexBasis: '33.33%',\n      flexShrink: 0\n    }, _defineProperty(_heading, '@media (min-width:1100px)', {\n      // eslint-disable-line no-useless-computed-key\n      flexBasis: '13%'\n    }), _defineProperty(_heading, '@media (max-width:545px)', {\n      // eslint-disable-line no-useless-computed-key\n      flexBasis: '100%'\n    }), _defineProperty(_heading, \"p\", {\n      display: \"inline-block\"\n    }), _heading),\n    secondaryHeading: {\n      fontSize: theme.typography.pxToRem(15),\n      color: theme.palette.text.secondary\n    }\n  };\n});\n\nfunction ServiceVisits(props) {\n  var _props$zipcode_fn,\n      _this = this;\n\n  var _useTranslation = useTranslation('translation', {\n    keyPrefix: 'services.visits'\n  }),\n      t = _useTranslation.t;\n\n  var classes = useStyles();\n\n  var handleVisitChange = function handleVisitChange(panel) {\n    return function (event, newExpanded) {};\n  };\n\n  var _useState = useState({\n    start: \"\",\n    end: \"\"\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      event = _useState2[0],\n      setEvent = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      technicians_ids = _useState4[0],\n      setTechniciansIds = _useState4[1];\n\n  var address_fn = [\"\".concat(props.street_type_fn || '', \" \").concat(props.street_name_fn || '').trim(), \"\".concat(props.ext_number_fn || '', \" \").concat(props.int_number_fn || '').trim(), props.administrative_demarcation_fn != null ? props.administrative_demarcation.admin3_admin1 : props.state_fn, !!((_props$zipcode_fn = props.zipcode_fn) !== null && _props$zipcode_fn !== void 0 && _props$zipcode_fn.length) ? \"C\\xF3digo Postal: \".concat(props.zipcode_fn) : \"\"].filter(function (u) {\n    return !!(u !== null && u !== void 0 && u.length);\n  }).join(\", \") || \"-\";\n\n  function saveVisit() {\n    var save_function_param = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : true;\n    var custom_event = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    var body = new FormData();\n    body.set('technicians_ids', technicians_ids);\n\n    if (custom_event) {\n      body.set('event_start', custom_event.start);\n      body.set('event_end', custom_event.end);\n    } else {\n      body.set('event_start', event.start);\n      body.set('event_end', event.end);\n    }\n\n    return axios.patch(\"/api/v1/services/\".concat(props.serviceID, \"/visits/\").concat(save_function_param, \"/update_visit\"), body, {\n      headers: headers\n    }).then(function (response) {\n      flash_alert(\"Guardado\", t('flashAlert.rescheduled'), \"success\");\n      props.scheduleCallBack();\n    })[\"catch\"](function (e) {\n      if (e.response.data) {\n        console.log(e.response.data);\n        props.scheduleCallBack();\n\n        for (var key in e.response.data) {\n          flash_alert(\"Error\", e.response.data[key], \"danger\");\n        }\n      }\n    });\n  }\n\n  function confirmVisit(_x, _x2) {\n    return _confirmVisit.apply(this, arguments);\n  }\n\n  function _confirmVisit() {\n    _confirmVisit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(visit_id, visit) {\n      var paymentVisit, visitPaymentStatus, body;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return fetchPaymentVisit(visit.id, visit.service_id);\n\n            case 2:\n              paymentVisit = _context.sent;\n              visitPaymentStatus = visitArePayment(visit);\n\n              if (visitPaymentStatus) {\n                _context.next = 7;\n                break;\n              }\n\n              flash_alert(\"Error\", t('flashAlert.unpaidVisit'), \"danger\");\n              return _context.abrupt(\"return\");\n\n            case 7:\n              if (!(!visitPaymentStatus && !(!!Object.keys(paymentVisit).length && paymentVisit.status == 'completed'))) {\n                _context.next = 10;\n                break;\n              }\n\n              flash_alert(\"Error\", t('flashAlert.unpaidVisit'), \"danger\");\n              return _context.abrupt(\"return\");\n\n            case 10:\n              if (props.ibsNumber) {\n                _context.next = 13;\n                break;\n              }\n\n              flash_alert(\"Error\", t('flashAlert.ibsNotPresent'), \"danger\");\n              return _context.abrupt(\"return\");\n\n            case 13:\n              body = new FormData();\n              body.set('technicians_ids', technicians_ids);\n              body.set('confirmed', true);\n              return _context.abrupt(\"return\", axios.patch(\"/api/v1/services/\".concat(props.serviceID, \"/visits/\").concat(visit_id, \"/update_visit\"), body, {\n                headers: headers\n              }).then(function (response) {\n                flash_alert(\"Guardado\", t('flashAlert.confirmVisit'), \"success\");\n                props.scheduleCallBack();\n              })[\"catch\"](function (e) {\n                if (e.response.data) {\n                  console.log(e.response.data);\n                  props.scheduleCallBack();\n\n                  for (var key in e.response.data) {\n                    flash_alert(\"Error\", e.response.data[key], \"danger\");\n                  }\n                }\n              }));\n\n            case 17:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _confirmVisit.apply(this, arguments);\n  }\n\n  function startVisit(visit_id) {\n    return axios.post(\"/api/v1/visits/\".concat(visit_id, \"/start\"), {}, {\n      headers: headers\n    }).then(function (response) {\n      flash_alert(\"Guardado\", t('flashAlert.visitStarted'), \"success\");\n      props.scheduleCallBack();\n    })[\"catch\"](function (e) {\n      if (e.response.data) {\n        console.log(e.response.data);\n        props.scheduleCallBack();\n\n        for (var key in e.response.data) {\n          flash_alert(\"Error\", e.response.data[key], \"danger\");\n        }\n      }\n    });\n  }\n\n  function finishVisit(visit_id) {\n    return axios.post(\"/api/v1/visits/\".concat(visit_id, \"/finish\"), {}, {\n      headers: headers\n    }).then(function (response) {\n      flash_alert(\"Guardado\", t('flashAlert.visitEnded'), \"success\");\n      props.scheduleCallBack();\n    })[\"catch\"](function (e) {\n      if (e.response.data) {\n        console.log(e.response.data);\n        props.scheduleCallBack();\n\n        for (var key in e.response.data) {\n          flash_alert(\"Error\", e.response.data[key], \"danger\");\n        }\n      }\n    });\n  }\n\n  function arrivalVisit(visit_id) {\n    return axios.post(\"/api/v1/visits/\".concat(visit_id, \"/arrival\"), {}, {\n      headers: headers\n    }).then(function (response) {\n      flash_alert(\"Guardado\", t('flashAlert.notificationOfArrival'), \"success\");\n      props.scheduleCallBack();\n    })[\"catch\"](function (e) {\n      if (e.response.data) {\n        console.log(e.response.data);\n        props.scheduleCallBack();\n\n        for (var key in e.response.data) {\n          flash_alert(\"Error\", e.response.data[key], \"danger\");\n        }\n      }\n    });\n  }\n\n  function visitArePayment(visit) {\n    if (!visit) {\n      return true;\n    }\n\n    return visit.validated_payment || visit.payment_state == 'paid' || visit.no_payment;\n  }\n\n  function lastVisitArePayment() {\n    var lastQuotation = props.quotations[0] || [];\n\n    if (lastQuotation.length === 0) {\n      return true;\n    }\n\n    return lastQuotation.validated_payment;\n  }\n\n  function handleNewVisit(e) {\n    var lastVisit = props.visits[0];\n\n    if (!(lastVisit.status == 'Visita completada')) {\n      e.preventDefault();\n      flash_alert(\"Error\", t('flashAlert.finishTheLastVisit'), \"danger\");\n      return;\n    }\n\n    if (!lastVisitArePayment()) {\n      e.preventDefault();\n      flash_alert(\"Error\", t('flashAlert.quoteNotPaid'), \"danger\");\n      return;\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 231,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Accordion, {\n    defaultExpanded: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AccordionSummary, {\n    expandIcon: /*#__PURE__*/React.createElement(ExpandMoreIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236,\n        columnNumber: 23\n      }\n    }),\n    \"aria-controls\": \"panel2a-content\",\n    id: \"paneladditional-header\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"panel-custom-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 240,\n      columnNumber: 11\n    }\n  }, t('title'))), /*#__PURE__*/React.createElement(AccordionDetails, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 1,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 244,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    className: classes.root,\n    direction: \"row\",\n    justify: \"flex-end\",\n    alignItems: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    sm: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    className: \"new-visit-link pull-right\",\n    onClick: handleNewVisit,\n    to: \"/customers/\".concat(props.customer_id, \"/services/\").concat(props.serviceID, \"/new_visit\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"outlined\",\n    color: \"primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 19\n    }\n  }, t('createVisit'))))), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 13\n    }\n  }, props.visits && props.service_technicians && props.visits.map(function (visit, index) {\n    var _React$createElement;\n\n    var labelId = \"accordeon-visit-\".concat(visit.id, \"-\").concat(index);\n    var current_techinician = props.service_technicians.find(function (technician) {\n      return technician.id == visit.principal_technician_id;\n    });\n    return /*#__PURE__*/React.createElement(Accordion, {\n      defaultExpanded: visit.status != 'Visita completada',\n      onChange: handleVisitChange(labelId),\n      key: labelId,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(AccordionSummary, {\n      className: 'summary-container',\n      expandIcon: /*#__PURE__*/React.createElement(ExpandMoreIcon, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 35\n        }\n      }),\n      \"aria-controls\": \"\".concat(labelId, \"-content\"),\n      id: \"\".concat(labelId, \"-header\"),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 25\n      }\n    }, t('visit.title')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 84\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 59\n      }\n    }, \"N\\xB0 \", props.visits.length - index, \" \", visit.status == t(\"visit.completed\") ? visit.status : visit.confirmed ? t(\"visit.scheduled\") : t(\"visit.preScheduled\"))), visit.non_compliance && /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 27\n      }\n    }, /*#__PURE__*/React.createElement(Chip, {\n      size: \"small\",\n      label: \"Incumplimiento\",\n      color: \"primary\",\n      variant: \"outlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 29\n      }\n    }))), /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 25\n      }\n    }, t('date')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 77\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 25\n      }\n    }, visit.calendar_event && date_event_format(visit.calendar_event.start_date, visit.calendar_event.finish_date))), /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 291,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 25\n      }\n    }, t('principalTechnician')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 92\n      }\n    }), current_techinician && /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 49\n      }\n    }, current_techinician.enterprise != \"\" && current_techinician.enterprise != null ? current_techinician.user.fullname + \" (\" + current_techinician.enterprise + \")\" : current_techinician.user.fullname)), /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 25\n      }\n    }, t('waitTime')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296,\n        columnNumber: 81\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 25\n      }\n    }, visit.arrival_time_diff, \" \", pluralize(t('hour'), visit.time_diff))), /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 25\n      }\n    }, t('visitTime')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301,\n        columnNumber: 82\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302,\n        columnNumber: 25\n      }\n    }, visit.time_diff, \" \", pluralize(t('hour'), visit.time_diff))), /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading + \" visit-actions\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 23\n      }\n    }, visit.canceled_at == null && props.canConfirmVisit && /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 27\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      disabled: visit.confirmed,\n      className: props.btn_classname + \"customers-scheddule-visit-link\",\n      color: \"primary\",\n      onClick: function onClick() {\n        return confirmVisit(visit.id, visit);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(Tooltip, {\n      title: /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"service-tooltip\",\n        dangerouslySetInnerHTML: {\n          __html: \"Confirmar visita\" || \"\"\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310,\n          columnNumber: 35\n        }\n      })),\n      arrow: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 31\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"material-icons\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 34\n      }\n    }, \"done\")))) || /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 27\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      disabled: visit.confirmed,\n      className: props.btn_classname + \"customers-scheddule-visit-link\",\n      color: \"primary\",\n      onClick: function onClick() {\n        return confirmVisit(visit.id, visit);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(Tooltip, {\n      title: /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 321,\n          columnNumber: 33\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"service-tooltip\",\n        dangerouslySetInnerHTML: {\n          __html: \"<span className=\\\"visit-summary-2\\\">(\".concat(date_format(visit.canceled_at), \"), \").concat(visit.cancel_from, \", Motivo: \").concat(visit.cancel_reason, \"</span>\") || \"\"\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 35\n        }\n      })),\n      arrow: true,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 31\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 34\n      }\n    }, t('visitCancel'))))), /*#__PURE__*/React.createElement(Typography, {\n      className: classes.heading,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 25\n      }\n    }, visit.canceled_at == null && /*#__PURE__*/React.createElement(NewScheduleDialog, {\n      key: \"visit-schedule-\" + visit.id,\n      schedule_type: \"visit\",\n      btn_classname: \"\",\n      btn_text: \"Reagendar visita\",\n      customer_id: props.customer_id,\n      country: props.country,\n      selectedProductRows: props.selectedProductRows,\n      service_type: props.service_type,\n      subcategory: props.subcategory,\n      requested: props.requested,\n      techinicianNumber: props.techinicianNumber,\n      zipcode: props.zipcode,\n      administrative_demarcation: props.administrative_demarcation,\n      setTechinicianNumber: props.setTechinicianNumber,\n      event: event,\n      setEvent: setEvent,\n      technicians_ids: technicians_ids,\n      setTechniciansIds: setTechniciansIds,\n      saveService: saveVisit,\n      technicians: props.technicians,\n      setTechnicians: props.setTechnicians // Visit specific\n      ,\n      current_visit: visit.id,\n      current_event: visit.calendar_event && {\n        start: visit.calendar_event.start_date,\n        end: visit.calendar_event.finish_date\n      } // Callbacks\n      ,\n      scheduleCallBack: props.scheduleCallBack,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 29\n      }\n    })), visit.canceled_at == null && /*#__PURE__*/React.createElement(StartVisitBtn, {\n      visit_id: visit.id,\n      startVisit: startVisit,\n      finishVisit: finishVisit,\n      arrivalVisit: arrivalVisit,\n      key: \"visit-btn-\" + visit.id,\n      classes: classes,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 27\n      }\n    }), /*#__PURE__*/React.createElement(CanceVisitDialog, {\n      key: \"visit-cancel-\" + visit.id,\n      classes: classes,\n      visit: visit,\n      btn_classname: props.btn_classname,\n      callbacks: props.scheduleCallBack,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 376,\n        columnNumber: 25\n      }\n    }))), /*#__PURE__*/React.createElement(AccordionDetails, {\n      className: \"visit-accordeon-details\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Grid, {\n      container: true,\n      spacing: 1,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(VisitTechnicians, {\n      service_technicians: props.service_technicians,\n      visit: visit,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      xs: 12,\n      sm: 1,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 27\n      }\n    }, t('bill')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 79\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 27\n      }\n    }, props.invoiceCheck)), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      xs: 12,\n      sm: 4,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 27\n      }\n    }, t('billingAddress')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 89\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 27\n      }\n    }, address_fn)), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      xs: 12,\n      sm: 2,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 27\n      }\n    }, t('startTime')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 84\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 27\n      }\n    }, visit.start_time ? date_format(visit.start_time) : \"-\")), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      xs: 12,\n      sm: 2,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-1\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 27\n      }\n    }, t('endTime')), /*#__PURE__*/React.createElement(\"br\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 82\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"visit-summary-2\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 27\n      }\n    }, visit.finish_time ? date_format(visit.finish_time) : \"-\")), visit.status == \"Visita completada\" && /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      xs: 12,\n      sm: 4,\n      className: \"visit-download-link-container\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 27\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      className: \"mdl-navigation__link MuiButton-textPrimary\",\n      href: \"/services/\".concat(props.serviceID, \"/report_pdf?visit_id=\").concat(visit.id),\n      target: \"_blank\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 412,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"material-icons\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 31\n      }\n    }, \"download\"), \" \", t('downloadReport'))), visit.dispatch_guide_url_pdf != null &&\n    /*#__PURE__*/\n    //quizas poner igual distinto de \"\"\n    React.createElement(Grid, {\n      item: true,\n      xs: 12,\n      sm: 7,\n      className: \"visit-download-link-container\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 27\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      className: \"mdl-navigation__link MuiButton-textPrimary\",\n      href: \"\".concat(b2b_site_url(process.env.RAILS_ENV)) + visit.dispatch_guide_url_pdf,\n      target: \"_blank\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 420,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"material-icons\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 31\n      }\n    }, \"download\"), t('downloadShippingGuide'), \" \", visit.dispatch_guide)), /*#__PURE__*/React.createElement(Grid, {\n      item: true,\n      xs: 12,\n      style: {\n        marginTop: \"15px\"\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 425,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(VisitTabs, (_React$createElement = {\n      subcategory: props.subcategory,\n      customerID: props.customer_id,\n      serviceID: props.serviceID,\n      service_type: props.service_type,\n      visit: visit,\n      paymentChannel: props.paymentChannel,\n      country: props.country,\n      totalAmount: props.totalAmount,\n      noPaymentCheck: props.noPaymentCheck,\n      noPaymentOption: props.noPaymentOption,\n      validated_payment: props.validated_payment,\n      invoiceCheck: props.invoiceCheck,\n      paymentFiles: props.paymentFiles // Totals\n      ,\n      selectedPaymentDate: props.selectedPaymentDate,\n      customerPaymentDate: props.customerPaymentDate,\n      totalhours: props.totalhours,\n      hourAmout: props.hourAmout,\n      feeAmount: props.feeAmount,\n      laborAmount: props.laborAmount,\n      consumableAmount: props.consumableAmount,\n      ivaAmount: props.ivaAmount,\n      viaticAmout: props.viaticAmout,\n      subtotalAmount: props.subtotalAmount\n    }, _defineProperty(_React$createElement, \"totalAmount\", props.totalAmount), _defineProperty(_React$createElement, \"selectedConsumables\", props.selectedConsumables), _defineProperty(_React$createElement, \"zipcode_fn\", props.zipcode_fn), _defineProperty(_React$createElement, \"state_fn\", props.state_fn), _defineProperty(_React$createElement, \"delegation_fn\", props.delegation_fn), _defineProperty(_React$createElement, \"colony_fn\", props.colony_fn), _defineProperty(_React$createElement, \"street_type_fn\", props.street_type_fn), _defineProperty(_React$createElement, \"street_name_fn\", props.street_name_fn), _defineProperty(_React$createElement, \"ext_number_fn\", props.ext_number_fn), _defineProperty(_React$createElement, \"int_number_fn\", props.int_number_fn), _defineProperty(_React$createElement, \"phone_fn\", props.phone_fn), _defineProperty(_React$createElement, \"administrative_demarcation_fn\", props.administrative_demarcation_fn), _defineProperty(_React$createElement, \"callbacks\", props.callbacks), _defineProperty(_React$createElement, \"__self\", _this), _defineProperty(_React$createElement, \"__source\", {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 27\n    }), _React$createElement))))));\n  }))))));\n}\n\nvar structuredSelector = createStructuredSelector({});\nvar mapDispatchToProps = {};\nexport default connect(structuredSelector, mapDispatchToProps)(ServiceVisits);","map":{"version":3,"sources":["/usr/src/app/javascript/components/services/visits/ServiceVisits.jsx"],"names":["React","useState","useEffect","axios","connect","createStructuredSelector","Grid","flash_alert","csrf","headers","money_format","date_format","date_event_format","date_difference_in_hours","pluralize","Accordion","AccordionSummary","AccordionDetails","Typography","ExpandMoreIcon","makeStyles","Link","NewScheduleDialog","Button","Tooltip","VisitTabs","StartVisitBtn","CanceVisitDialog","VisitTechnicians","Chip","b2b_site_url","fetchPaymentVisit","useTranslation","useStyles","theme","root","margin","spacing","heading","fontSize","typography","pxToRem","flexBasis","flexShrink","display","secondaryHeading","color","palette","text","secondary","ServiceVisits","props","keyPrefix","t","classes","handleVisitChange","panel","event","newExpanded","start","end","setEvent","technicians_ids","setTechniciansIds","address_fn","street_type_fn","street_name_fn","trim","ext_number_fn","int_number_fn","administrative_demarcation_fn","administrative_demarcation","admin3_admin1","state_fn","zipcode_fn","length","filter","u","join","saveVisit","save_function_param","custom_event","body","FormData","set","patch","serviceID","then","response","scheduleCallBack","e","data","console","log","key","confirmVisit","visit_id","visit","id","service_id","paymentVisit","visitPaymentStatus","visitArePayment","Object","keys","status","ibsNumber","startVisit","post","finishVisit","arrivalVisit","validated_payment","payment_state","no_payment","lastVisitArePayment","lastQuotation","quotations","handleNewVisit","lastVisit","visits","preventDefault","customer_id","service_technicians","map","index","labelId","current_techinician","find","technician","principal_technician_id","confirmed","non_compliance","calendar_event","start_date","finish_date","enterprise","user","fullname","arrival_time_diff","time_diff","canceled_at","canConfirmVisit","btn_classname","__html","cancel_from","cancel_reason","country","selectedProductRows","service_type","subcategory","requested","techinicianNumber","zipcode","setTechinicianNumber","technicians","setTechnicians","invoiceCheck","start_time","finish_time","dispatch_guide_url_pdf","process","env","RAILS_ENV","dispatch_guide","marginTop","paymentChannel","totalAmount","noPaymentCheck","noPaymentOption","paymentFiles","selectedPaymentDate","customerPaymentDate","totalhours","hourAmout","feeAmount","laborAmount","consumableAmount","ivaAmount","viaticAmout","subtotalAmount","selectedConsumables","delegation_fn","colony_fn","phone_fn","callbacks","structuredSelector","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\n\nimport axios from 'axios';\nimport { connect } from \"react-redux\"\nimport { createStructuredSelector } from \"reselect\"\nimport Grid from '@material-ui/core/Grid';\nimport { flash_alert } from 'components/App';\nimport { csrf, headers, money_format, date_format, date_event_format, date_difference_in_hours } from \"constants/csrf\"\nimport pluralize from 'pluralize';\nimport Accordion from '@material-ui/core/Accordion';\nimport AccordionSummary from '@material-ui/core/AccordionSummary';\nimport AccordionDetails from '@material-ui/core/AccordionDetails';\nimport Typography from '@material-ui/core/Typography';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { Link } from 'react-router-dom'\nimport NewScheduleDialog from \"components/services/NewScheduleDialog\";\nimport Button from '@material-ui/core/Button';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport VisitTabs from \"components/services/visits/VisitTabs\";\nimport StartVisitBtn from \"components/services/visits/StartVisitBtn\";\nimport CanceVisitDialog from \"components/services/visits/CanceVisitDialog\";\nimport VisitTechnicians from \"components/services/visits/VisitTechnicians\";\nimport Chip from '@material-ui/core/Chip';\nimport { b2b_site_url } from '../../../constants/csrf';\nimport { fetchPaymentVisit } from 'api/visit'\nimport {useTranslation} from \"react-i18next\"\n\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    '& > *': {\n      margin: theme.spacing(1),\n    },\n  },\n  heading: {\n    fontSize: theme.typography.pxToRem(15),\n    flexBasis: '33.33%',\n    flexShrink: 0,\n    ['@media (min-width:1100px)']: { // eslint-disable-line no-useless-computed-key\n      flexBasis: '13%',\n    },\n    ['@media (max-width:545px)']: { // eslint-disable-line no-useless-computed-key\n      flexBasis: '100%',\n    },\n    p: {\n      display: \"inline-block\",\n    }\n  },\n  secondaryHeading: {\n    fontSize: theme.typography.pxToRem(15),\n    color: theme.palette.text.secondary,\n  },\n}));\n\nfunction ServiceVisits(props) {\n  const { t } = useTranslation('translation', { keyPrefix: 'services.visits' });\n  \n\n  const classes = useStyles();\n\n  const handleVisitChange = (panel) => (event, newExpanded) => {\n  };\n\n  const [event, setEvent] = useState({ start: \"\", end: \"\" });\n  const [technicians_ids, setTechniciansIds] = useState(\"\");\n  const address_fn = [\n  `${props.street_type_fn || ''} ${props.street_name_fn || ''}`.trim(),\n  `${props.ext_number_fn || ''} ${props.int_number_fn || ''}`.trim(),\n  props.administrative_demarcation_fn != null ? props.administrative_demarcation.admin3_admin1 : props.state_fn,\n  !!props.zipcode_fn?.length ? (`Código Postal: ${props.zipcode_fn}`) : \"\"\n  ].filter(u => !!u?.length).join(\", \") || \"-\"\n\n\n  function saveVisit(save_function_param = true, custom_event = null) {\n\n    var body = new FormData();\n    body.set('technicians_ids', technicians_ids);\n    if (custom_event) {\n      body.set('event_start', custom_event.start);\n      body.set('event_end', custom_event.end);\n    } else {\n      body.set('event_start', event.start);\n      body.set('event_end', event.end);\n    }\n    return axios.patch(`/api/v1/services/${props.serviceID}/visits/${save_function_param}/update_visit`, body, { headers: headers })\n      .then(response => {\n        flash_alert(\"Guardado\", t('flashAlert.rescheduled'), \"success\")\n        props.scheduleCallBack();\n      })\n      .catch(e => {\n        if (e.response.data) {\n          console.log(e.response.data);\n          props.scheduleCallBack();\n          for (var key in e.response.data) {\n            flash_alert(\"Error\", e.response.data[key], \"danger\")\n          }\n        }\n      });\n  }\n\n  async function confirmVisit(visit_id, visit) {\n    const paymentVisit = await fetchPaymentVisit(visit.id, visit.service_id)\n    const visitPaymentStatus = visitArePayment(visit)\n    if (!visitPaymentStatus) {\n      flash_alert(\"Error\", t('flashAlert.unpaidVisit'), \"danger\")\n      return\n    }\n\n    if (!visitPaymentStatus && !(!!Object.keys(paymentVisit).length && paymentVisit.status == 'completed')) {\n      flash_alert(\"Error\", t('flashAlert.unpaidVisit'), \"danger\")\n      return\n    }\n\n\n    if (!props.ibsNumber) {\n      flash_alert(\"Error\", t('flashAlert.ibsNotPresent'), \"danger\")\n      return\n    }\n\n    var body = new FormData();\n    body.set('technicians_ids', technicians_ids);\n    body.set('confirmed', true);\n    return axios.patch(`/api/v1/services/${props.serviceID}/visits/${visit_id}/update_visit`, body, { headers: headers })\n      .then(response => {\n        flash_alert(\"Guardado\", t('flashAlert.confirmVisit'), \"success\")\n        props.scheduleCallBack();\n      })\n      .catch(e => {\n        if (e.response.data) {\n          console.log(e.response.data);\n          props.scheduleCallBack();\n          for (var key in e.response.data) {\n            flash_alert(\"Error\", e.response.data[key], \"danger\")\n          }\n        }\n      });\n  }\n\n\n\n\n\n  function startVisit(visit_id) {\n    return axios.post(`/api/v1/visits/${visit_id}/start`, {}, { headers: headers })\n      .then(response => {\n        flash_alert(\"Guardado\", t('flashAlert.visitStarted'), \"success\")\n        props.scheduleCallBack();\n      })\n      .catch(e => {\n        if (e.response.data) {\n          console.log(e.response.data);\n          props.scheduleCallBack();\n          for (var key in e.response.data) {\n            flash_alert(\"Error\", e.response.data[key], \"danger\")\n          }\n        }\n      });\n\n  }\n  function finishVisit(visit_id) {\n    return axios.post(`/api/v1/visits/${visit_id}/finish`, {}, { headers: headers })\n      .then(response => {\n        flash_alert(\"Guardado\", t('flashAlert.visitEnded'), \"success\")\n        props.scheduleCallBack();\n      })\n      .catch(e => {\n        if (e.response.data) {\n          console.log(e.response.data);\n          props.scheduleCallBack();\n          for (var key in e.response.data) {\n            flash_alert(\"Error\", e.response.data[key], \"danger\")\n          }\n        }\n      });\n\n  }\n\n  function arrivalVisit(visit_id) {\n    return axios.post(`/api/v1/visits/${visit_id}/arrival`, {}, { headers: headers })\n      .then(response => {\n        flash_alert(\"Guardado\", t('flashAlert.notificationOfArrival'), \"success\")\n        props.scheduleCallBack();\n      })\n      .catch(e => {\n        if (e.response.data) {\n          console.log(e.response.data);\n          props.scheduleCallBack();\n          for (var key in e.response.data) {\n            flash_alert(\"Error\", e.response.data[key], \"danger\")\n          }\n        }\n      });\n\n  }\n\n  function visitArePayment(visit) {\n\n    if (!visit) { return true }\n\n    return visit.validated_payment || visit.payment_state == 'paid' || visit.no_payment\n  }\n\n  function lastVisitArePayment() {\n    const lastQuotation = props.quotations[0] || []\n    if (lastQuotation.length === 0) {\n      return true\n    }\n\n    return lastQuotation.validated_payment\n  }\n\n  function handleNewVisit(e) {\n\n    const lastVisit = props.visits[0]\n    if (!(lastVisit.status == 'Visita completada')) {\n      e.preventDefault()\n      flash_alert(\"Error\", t('flashAlert.finishTheLastVisit'), \"danger\")\n      return\n    }\n\n    if (!lastVisitArePayment()) {\n      e.preventDefault()\n      flash_alert(\"Error\", t('flashAlert.quoteNotPaid'), \"danger\")\n      return\n    }\n\n  }\n\n  return (\n    <React.Fragment>\n\n      <Accordion defaultExpanded>\n\n        <AccordionSummary\n          expandIcon={<ExpandMoreIcon />}\n          aria-controls=\"panel2a-content\"\n          id=\"paneladditional-header\"\n        >\n          <h1 className=\"panel-custom-title\">{t('title')}</h1>\n\n        </AccordionSummary>\n        <AccordionDetails>\n          <Grid container spacing={1}>\n            <Grid container\n              className={classes.root}\n              direction=\"row\"\n              justify=\"flex-end\"\n              alignItems=\"center\">\n              <Grid item xs={12} sm={2}>\n                <Link className=\"new-visit-link pull-right\" onClick={handleNewVisit} to={`/customers/${props.customer_id}/services/${props.serviceID}/new_visit`}>\n                  <Button variant=\"outlined\" color=\"primary\">\n                    {t('createVisit')}\n                  </Button>\n                </Link>\n              </Grid>\n            </Grid>\n            <Grid item xs={12}>\n              {props.visits && props.service_technicians && props.visits.map((visit, index) => {\n                const labelId = `accordeon-visit-${visit.id}-${index}`;\n                const current_techinician = props.service_technicians.find(function(technician) {\n                  return technician.id == visit.principal_technician_id;\n                }\n                );\n                return (\n                  <Accordion defaultExpanded={visit.status != 'Visita completada'} onChange={handleVisitChange(labelId)} key={labelId}>\n                    <AccordionSummary\n                      className={'summary-container'}\n                      expandIcon={<ExpandMoreIcon />}\n                      aria-controls={`${labelId}-content`}\n                      id={`${labelId}-header`} >\n                      <Typography className={classes.heading}>\n                        <span className=\"visit-summary-1\">{t('visit.title')}</span><br />\n                        <span className=\"visit-summary-2\"><strong>N° {props.visits.length - index} {visit.status == t(\"visit.completed\") ? visit.status : (visit.confirmed ? t(\"visit.scheduled\") : t(\"visit.preScheduled\"))}</strong></span>\n                        {\n                          visit.non_compliance &&\n                          <span className=\"visit-summary-2\">\n                            <Chip\n                              size=\"small\"\n                              label=\"Incumplimiento\"\n                              color=\"primary\"\n                              variant=\"outlined\"\n                            />\n                          </span>\n                        }\n                      </Typography>\n                      <Typography className={classes.heading}>\n                        <span className=\"visit-summary-1\">{t('date')}</span><br />\n                        <span className=\"visit-summary-2\">{visit.calendar_event && date_event_format(visit.calendar_event.start_date, visit.calendar_event.finish_date)}</span>\n                      </Typography>\n                      <Typography className={classes.heading}>\n                        <span className=\"visit-summary-1\">{t('principalTechnician')}</span><br />\n                        {current_techinician && <span className=\"visit-summary-2\">{(current_techinician.enterprise != \"\" && current_techinician.enterprise != null) ? current_techinician.user.fullname + \" (\" + current_techinician.enterprise + \")\" : current_techinician.user.fullname}</span>}\n                      </Typography>\n                      <Typography className={classes.heading}>\n                        <span className=\"visit-summary-1\">{t('waitTime')}</span><br />\n                        <span className=\"visit-summary-2\">{visit.arrival_time_diff} {pluralize(t('hour'), visit.time_diff)}</span>\n                      </Typography>\n\n                      <Typography className={classes.heading}>\n                        <span className=\"visit-summary-1\">{t('visitTime')}</span><br />\n                        <span className=\"visit-summary-2\">{visit.time_diff} {pluralize(t('hour'), visit.time_diff)}</span>\n                      </Typography>\n                      <Typography className={classes.heading + \" visit-actions\"}>\n                        {visit.canceled_at == null && props.canConfirmVisit &&\n                          <Typography className={classes.heading}>\n                            <Button disabled={visit.confirmed} className={props.btn_classname + \"customers-scheddule-visit-link\"} color=\"primary\" onClick={() => confirmVisit(visit.id, visit)}>\n                              <Tooltip title={\n                                <React.Fragment>\n                                  <div className=\"service-tooltip\" dangerouslySetInnerHTML={{ __html: (\"Confirmar visita\" || \"\") }} />\n                                </React.Fragment>} arrow>\n                                {<i className=\"material-icons\">done</i>}\n                              </Tooltip>\n                            </Button>\n                          </Typography>\n                          ||\n\n                          <Typography className={classes.heading}>\n                            <Button disabled={visit.confirmed} className={props.btn_classname + \"customers-scheddule-visit-link\"} color=\"primary\" onClick={() => confirmVisit(visit.id, visit)}>\n                              <Tooltip title={\n                                <React.Fragment>\n                                  <div className=\"service-tooltip\" dangerouslySetInnerHTML={{ __html: (`<span className=\"visit-summary-2\">(${date_format(visit.canceled_at)}), ${visit.cancel_from}, Motivo: ${visit.cancel_reason}</span>` || \"\") }} />\n                                </React.Fragment>} arrow>\n                                {<span className=\"visit-summary-1\">{t('visitCancel')}</span>}\n                              </Tooltip>\n                            </Button>\n\n\n                          </Typography>\n                        }\n\n                        <Typography className={classes.heading}>\n                          {visit.canceled_at == null &&\n                            <NewScheduleDialog\n                              key={\"visit-schedule-\" + visit.id}\n                              schedule_type=\"visit\"\n                              btn_classname={\"\"}\n                              btn_text={\"Reagendar visita\"}\n                              customer_id={props.customer_id}\n                              country={props.country}\n                              selectedProductRows={props.selectedProductRows}\n                              service_type={props.service_type}\n                              subcategory={props.subcategory}\n                              requested={props.requested}\n                              techinicianNumber={props.techinicianNumber}\n                              zipcode={props.zipcode}\n                              administrative_demarcation={props.administrative_demarcation}\n                              setTechinicianNumber={props.setTechinicianNumber}\n                              event={event}\n                              setEvent={setEvent}\n                              technicians_ids={technicians_ids}\n                              setTechniciansIds={setTechniciansIds}\n                              saveService={saveVisit}\n                              technicians={props.technicians}\n                              setTechnicians={props.setTechnicians}\n\n                              // Visit specific\n                              current_visit={visit.id}\n                              current_event={visit.calendar_event && { start: visit.calendar_event.start_date, end: visit.calendar_event.finish_date }}\n                              // Callbacks\n                              scheduleCallBack={props.scheduleCallBack}\n                            />\n                          }\n\n                        </Typography>\n                        {visit.canceled_at == null &&\n                          <StartVisitBtn\n                            visit_id={visit.id}\n                            startVisit={startVisit}\n                            finishVisit={finishVisit}\n                            arrivalVisit={arrivalVisit}\n                            key={\"visit-btn-\" + visit.id}\n                            classes={classes}\n                          />\n                        }\n                        <CanceVisitDialog\n                          key={\"visit-cancel-\" + visit.id}\n                          classes={classes}\n                          visit={visit}\n                          btn_classname={props.btn_classname}\n                          callbacks={props.scheduleCallBack}\n                        />\n                      </Typography>\n\n                    </AccordionSummary>\n                    <AccordionDetails className=\"visit-accordeon-details\">\n                      <Grid container spacing={1}>\n\n                        <VisitTechnicians\n                          service_technicians={props.service_technicians}\n                          visit={visit}\n                        />\n                        <Grid item xs={12} sm={1}>\n                          <span className=\"visit-summary-1\">{t('bill')}</span><br />\n                          <span className=\"visit-summary-2\">{props.invoiceCheck}</span>\n                        </Grid>\n                        <Grid item xs={12} sm={4}>\n                          <span className=\"visit-summary-1\">{t('billingAddress')}</span><br />\n                          <span className=\"visit-summary-2\">{address_fn}</span>\n                        </Grid>\n                        <Grid item xs={12} sm={2}>\n                          <span className=\"visit-summary-1\">{t('startTime')}</span><br />\n                          <span className=\"visit-summary-2\">{visit.start_time ? date_format(visit.start_time) : \"-\"}</span>\n                        </Grid>\n                        <Grid item xs={12} sm={2}>\n                          <span className=\"visit-summary-1\">{t('endTime')}</span><br />\n                          <span className=\"visit-summary-2\">{visit.finish_time ? date_format(visit.finish_time) : \"-\"}</span>\n                        </Grid>\n                        {\n                          visit.status == \"Visita completada\" &&\n                          <Grid item xs={12} sm={4} className={\"visit-download-link-container\"}>\n                            <a className=\"mdl-navigation__link MuiButton-textPrimary\" href={`/services/${props.serviceID}/report_pdf?visit_id=${visit.id}`} target=\"_blank\">\n                              <i className=\"material-icons\">download</i> {t('downloadReport')}\n                            </a>\n                          </Grid>\n                        }\n                        {\n                          visit.dispatch_guide_url_pdf != null && //quizas poner igual distinto de \"\"\n                          <Grid item xs={12} sm={7} className={\"visit-download-link-container\"}>\n                            <a className=\"mdl-navigation__link MuiButton-textPrimary\" href={`${b2b_site_url(process.env.RAILS_ENV)}` + visit.dispatch_guide_url_pdf} target=\"_blank\">\n                              <i className=\"material-icons\">download</i>{t('downloadShippingGuide')} {visit.dispatch_guide}\n                            </a>\n                          </Grid>\n                        }\n                        <Grid item xs={12} style={{ marginTop: \"15px\" }}>\n                          <VisitTabs\n                            subcategory={props.subcategory}\n                            customerID={props.customer_id}\n                            serviceID={props.serviceID}\n                            service_type={props.service_type}\n                            visit={visit}\n                            paymentChannel={props.paymentChannel}\n                            country={props.country}\n                            totalAmount={props.totalAmount}\n                            noPaymentCheck={props.noPaymentCheck}\n                            noPaymentOption={props.noPaymentOption}\n                            validated_payment={props.validated_payment}\n                            invoiceCheck={props.invoiceCheck}\n                            paymentFiles={props.paymentFiles}\n                            // Totals\n                            selectedPaymentDate={props.selectedPaymentDate}\n                            customerPaymentDate={props.customerPaymentDate}\n                            totalhours={props.totalhours}\n                            hourAmout={props.hourAmout}\n                            feeAmount={props.feeAmount}\n                            laborAmount={props.laborAmount}\n                            consumableAmount={props.consumableAmount}\n                            ivaAmount={props.ivaAmount}\n                            viaticAmout={props.viaticAmout}\n                            subtotalAmount={props.subtotalAmount}\n                            totalAmount={props.totalAmount}\n                            selectedConsumables={props.selectedConsumables}\n                            // Bill address\n                            zipcode_fn={props.zipcode_fn}\n                            state_fn={props.state_fn}\n                            delegation_fn={props.delegation_fn}\n                            colony_fn={props.colony_fn}\n                            street_type_fn={props.street_type_fn}\n                            street_name_fn={props.street_name_fn}\n                            ext_number_fn={props.ext_number_fn}\n                            int_number_fn={props.int_number_fn}\n                            phone_fn={props.phone_fn}\n                            administrative_demarcation_fn={props.administrative_demarcation_fn}\n\n                            //callbacks\n                            callbacks={props.callbacks}\n\n                          />\n\n                        </Grid>\n                      </Grid>\n                    </AccordionDetails>\n                  </Accordion>\n                );\n              })}\n            </Grid>\n          </Grid>\n        </AccordionDetails>\n      </Accordion>\n\n\n\n    </React.Fragment>\n  );\n\n}\n\nconst structuredSelector = createStructuredSelector({\n});\nconst mapDispatchToProps = {};\n\nexport default connect(structuredSelector, mapDispatchToProps)(ServiceVisits)\n\n"]},"metadata":{},"sourceType":"module"}