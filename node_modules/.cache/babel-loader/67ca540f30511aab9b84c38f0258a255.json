{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/javascript/components/finance/index.jsx\",\n    _this = this;\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport axios from 'axios';\nimport React, { useState, useEffect } from 'react';\nimport { KeyboardArrowUp, KeyboardArrowDown } from '@material-ui/icons';\nimport ModalConfirmation from './modalConfirmation';\nimport ModalDownloadConfirmation from './ModalDownloadConfirmation';\nimport PropTypes from \"prop-types\";\nimport { connect } from \"react-redux\";\nimport { Link } from 'react-router-dom';\nimport VisitDetail from './VisitDetail';\nimport FinanceFilter from './FinanceFilter';\nimport { createStructuredSelector } from \"reselect\";\nimport MaterialTable from 'react-data-table-component';\nimport { withRouter } from 'react-router-dom';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport { toQueryParams } from './utils';\nimport { Checkbox, FormControl, CircularProgress, Button, IconButton, InputAdornment, OutlinedInput, InputLabel, AccordionDetails, Accordion, Box, Grid } from '@material-ui/core';\nimport Close from '@material-ui/icons/Close';\nimport 'react-date-range/dist/styles.css'; // main style file\n\nimport 'react-date-range/dist/theme/default.css'; // theme css file\n\nimport { DateRangePicker } from \"materialui-daterange-picker\";\nimport { visitAreCompleted, visitPaidStatus } from './utils';\nimport { useTranslation } from 'react-i18next';\nimport i18next from 'i18next';\nvar GET_SERVICES_REQUEST = \"GET_SERVICES_REQUEST\";\nvar GET_SERVICES_SUCCESS = \"GET_SERVICES_SUCCESS\";\nvar customStyles = {\n  subHeader: {\n    style: {\n      display: 'block'\n    }\n  }\n};\n\nvar FilterComponent = function FilterComponent(_ref) {\n  var setShowModalDownloadConfirmation = _ref.setShowModalDownloadConfirmation,\n      setServicesLoading = _ref.setServicesLoading,\n      getServices = _ref.getServices,\n      open = _ref.open,\n      toggle = _ref.toggle,\n      dateRange = _ref.dateRange,\n      setDateRange = _ref.setDateRange,\n      setOpen = _ref.setOpen,\n      filterText = _ref.filterText,\n      onFilter = _ref.onFilter,\n      onClear = _ref.onClear,\n      value = _ref.value,\n      setValue = _ref.setValue,\n      selectedVisits = _ref.selectedVisits,\n      setShowModalConfirmation = _ref.setShowModalConfirmation;\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    display: \"flex\",\n    justifyContent: \"flex-end\",\n    alignItems: \"center\",\n    width: \"100%\",\n    position: \"relative\",\n    component: \"div\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 54,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(FormControl, {\n    variant: \"outlined\",\n    className: \"custom-search\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    className: \"white-bg padding-sides-5 table-search-label\",\n    htmlFor: \"search\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 9\n    }\n  }, i18next.t('globalText.filterFor')), /*#__PURE__*/React.createElement(OutlinedInput, {\n    id: \"search\",\n    type: \"text\",\n    className: \"table-search-input\",\n    value: filterText,\n    onChange: onFilter,\n    endAdornment: /*#__PURE__*/React.createElement(InputAdornment, {\n      position: \"end\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(IconButton, {\n      \"aria-label\": \"toggle password visibility\",\n      onClick: onClear,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Close, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 18\n      }\n    }))),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 9\n    }\n  })), !open && /*#__PURE__*/React.createElement(Box, {\n    mr: 2,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: function onClick() {\n      setOpen(true);\n    },\n    className: \"mdl-navigation__link action-plus-btn\",\n    variant: \"outlined\",\n    color: \"primary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"material-icons\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }\n  }, \"date_range\"), \"\\xA0\\xA0\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"absolute-calentar\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(DateRangePicker, {\n    open: open,\n    toggle: toggle,\n    onChange: function onChange(range) {\n      return setDateRange(range);\n    },\n    initialDateRange: {\n      startDate: new Date(new Date().setMonth(new Date().getMonth() - 1)),\n      endDate: new Date(),\n      key: 'selection'\n    },\n    maxDate: new Date(),\n    minDate: new Date().setMonth(new Date().getMonth() - 6),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 9\n    }\n  })), dateRange.endDate && /*#__PURE__*/React.createElement(Button, {\n    className: \"mdl-navigation__link action-plus-btn\",\n    onClick: function onClick() {\n      return setShowModalDownloadConfirmation(true);\n    },\n    variant: \"outlined\",\n    color: \"primary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"material-icons\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }\n  }, \"download\"), \"\\xA0\\xA0\", i18next.t('services.downloadServices')), !dateRange.endDate && /*#__PURE__*/React.createElement(Button, {\n    disabled: true,\n    className: \"mdl-navigation__link action-plus-btn\",\n    target: \"_blank\",\n    variant: \"outlined\",\n    color: \"primary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"material-icons\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 11\n    }\n  }, \"download\"), \"\\xA0\\xA0\", i18next.t('services.downloadServices')), /*#__PURE__*/React.createElement(Box, {\n    ml: 2,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: function onClick() {\n      return setShowModalConfirmation(true);\n    },\n    disabled: !Object.keys(selectedVisits).length,\n    variant: \"contained\",\n    color: \"primary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 9\n    }\n  }, i18next.t('services.invoice')))), /*#__PURE__*/React.createElement(Box, {\n    width: \"100%\",\n    marginTop: 2,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(FinanceFilter, {\n    getServices: getServices,\n    setServicesLoading: setServicesLoading,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }\n  })));\n};\n\nfunction getServices() {\n  var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n  var per_page = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 10;\n  var filterText = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : \"\";\n  var setLoading = arguments.length > 3 ? arguments[3] : undefined;\n  var queryParams = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n  return function (dispatch) {\n    dispatch({\n      type: GET_SERVICES_REQUEST\n    });\n    dispatch(clearServices());\n\n    var params = _objectSpread({\n      page: page,\n      per_page: per_page == 5 ? 10 : per_page,\n      keywords: filterText\n    }, queryParams);\n\n    axios.get('/api/v1/services', {\n      params: params\n    }).then(function (json) {\n      return dispatch(getServicesSuccess(json.data, setLoading));\n    })[\"catch\"](function (error) {\n      return console.log(error);\n    });\n  };\n}\n\n;\nexport function getServicesSuccess(json, setLoading) {\n  setLoading(false);\n  return {\n    type: GET_SERVICES_SUCCESS,\n    json: json\n  };\n}\n;\nexport function clearServices() {\n  return {\n    type: GET_SERVICES_SUCCESS,\n    json: []\n  };\n}\n;\n\nfunction Finance(props) {\n  var _this2 = this;\n\n  var _useTranslation = useTranslation(),\n      t = _useTranslation.t;\n\n  var _React$useState = React.useState([new Date('2017-02-01'), new Date('2017-05-20')]),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      value = _React$useState2[0],\n      setValue = _React$useState2[1];\n\n  var _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      servicesLoading = _useState2[0],\n      setServicesLoading = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      showModalConfirmation = _useState4[0],\n      setShowModalConfirmation = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      showModalDownloadConfirmation = _useState6[0],\n      setShowModalDownloadConfirmation = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      selectedRows = _useState8[0],\n      setSelectedRows = _useState8[1];\n\n  var _useState9 = useState({}),\n      _useState10 = _slicedToArray(_useState9, 2),\n      selectedVisits = _useState10[0],\n      setSelectedVisits = _useState10[1];\n\n  var _useState11 = useState(1),\n      _useState12 = _slicedToArray(_useState11, 2),\n      page = _useState12[0],\n      setPage = _useState12[1];\n\n  var _useState13 = useState(10),\n      _useState14 = _slicedToArray(_useState13, 2),\n      perPage = _useState14[0],\n      setPerpage = _useState14[1];\n\n  var _useState15 = useState(\"\"),\n      _useState16 = _slicedToArray(_useState15, 2),\n      filterText = _useState16[0],\n      setFiltertext = _useState16[1];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      open = _React$useState4[0],\n      setOpen = _React$useState4[1];\n\n  var _React$useState5 = React.useState({\n    startDate: new Date(new Date().setMonth(new Date().getMonth() - 1)),\n    endDate: new Date(),\n    key: 'selection'\n  }),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      dateRange = _React$useState6[0],\n      setDateRange = _React$useState6[1];\n\n  var service_columns = [{\n    name: i18next.t('globalTables.serviceColumns.number'),\n    selector: 'number',\n    sortable: true,\n    grow: true,\n    minWidth: \"110px\",\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 9\n        }\n      }, row.number == \"\" ? \"-\" : row.number);\n    }\n  }, {\n    name: i18next.t('globalTables.serviceColumns.ibsNumber'),\n    selector: 'ibs_number',\n    sortable: true,\n    hide: 'sm',\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 9\n        }\n      }, !row.ibs_number ? i18next.t('globalText.noInfo') : row.ibs_number);\n    }\n  }, {\n    name: i18next.t('globalTables.serviceColumns.serviceType'),\n    selector: 'service_type',\n    sortable: true,\n    hide: 'md'\n  }, {\n    name: i18next.t('globalTables.serviceColumns.subCategory'),\n    selector: 'subcategory',\n    sortable: true,\n    hide: 'md',\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 9\n        }\n      }, !row.subcategory ? i18next.t('globalText.noInfo') : row.subcategory);\n    }\n  }, {\n    name: i18next.t('globalTables.serviceColumns.customerFullName'),\n    selector: 'customer_fullname',\n    sortable: true,\n    hide: 'md'\n  }, {\n    name: i18next.t('globalTables.serviceColumns.statusLabel'),\n    selector: 'status_label',\n    sortable: true,\n    hide: 'md'\n  }, {\n    name: i18next.t('globalTables.serviceColumns.identifier'),\n    selector: 'customer_rut',\n    sortable: true,\n    hide: 'md',\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233,\n          columnNumber: 9\n        }\n      }, !row.customer_rut ? row.customer_rfc : row.customer_rut);\n    }\n  }, {\n    name: i18next.t('globalTables.serviceColumns.actions'),\n    selector: 'id',\n    grow: true,\n    minWidth: \"120px\",\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Link, {\n        className: \"mdl-navigation__link brand-primary-link customers-show-link services-show-link mg-r-15\",\n        to: \"/customers/\".concat(row.customer_id, \"/services/\").concat(row.id, \"/edit_service\"),\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"material-icons material-icons-20\",\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247,\n          columnNumber: 13\n        }\n      }, \"assignment\"), \" \", i18next.t('globalText.details')));\n    }\n  }, {\n    name: '',\n    grow: true,\n    minWidth: \"1px\",\n    cell: function cell(row) {\n      return /*#__PURE__*/React.createElement(\"span\", {\n        __self: _this2,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 257,\n          columnNumber: 9\n        }\n      });\n    }\n  }];\n\n  var rowDisabledCriteria = function rowDisabledCriteria(row) {\n    return row.visits.length === 0 || rowValidation(row);\n  };\n\n  function rowValidation(service) {\n    var visitPending = service.visits.some(function (visit) {\n      return visit.invoiced === 'pending' && visitAreCompleted(visit) && (visitPaidStatus(visit) === 'paid' || visitPaidStatus(visit) == 'unrequired');\n    });\n    return !visitPending;\n  }\n\n  var toggle = function toggle() {\n    return setOpen(!open);\n  };\n\n  useEffect(function () {\n    function fetchData() {\n      return _fetchData.apply(this, arguments);\n    }\n\n    function _fetchData() {\n      _fetchData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                setServicesLoading(true);\n                props.getServices(page, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _fetchData.apply(this, arguments);\n    }\n\n    fetchData();\n  }, []);\n  useEffect(function () {\n    return function () {\n      setServicesLoading(true);\n      var delayDebounceFn = setTimeout(function () {\n        props.getServices(page, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n      }, 1000);\n      return function () {\n        return clearTimeout(delayDebounceFn);\n      };\n    };\n  }, [filterText]);\n  useEffect(function () {\n    setTimeout(function () {\n      var row = document.querySelectorAll('[role=\"row\"]')[0];\n      var childRow = row.childNodes[1];\n      row.removeChild(childRow);\n      document.querySelectorAll('[aria-label=\"Expand Row\"]').forEach(function (button) {\n        button.parentNode.style.position = 'absolute';\n        button.parentNode.style.right = 0;\n        button.parentNode.style.marginTop = '6px';\n        button.parentNode.style.marginRight = '8px';\n      });\n    }, 200);\n  }, [servicesLoading]);\n\n  function handlePageChange(_x) {\n    return _handlePageChange.apply(this, arguments);\n  }\n\n  function _handlePageChange() {\n    _handlePageChange = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(newPage) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setServicesLoading(true);\n              props.getServices(newPage, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _handlePageChange.apply(this, arguments);\n  }\n\n  function handlePerRowsChange(_x2, _x3) {\n    return _handlePerRowsChange.apply(this, arguments);\n  }\n\n  function _handlePerRowsChange() {\n    _handlePerRowsChange = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(newPerPage, newPage) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setServicesLoading(true);\n              props.getServices(newPage, newPerPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n              setPerpage(newPerPage);\n\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n    return _handlePerRowsChange.apply(this, arguments);\n  }\n\n  function handleRowChange(state) {\n    setSelectedRows(state.selectedRows);\n    var newSelectedVisits = {};\n    state.selectedRows.forEach(function (service) {\n      newSelectedVisits[service.id] = service.visits.filter(function (visit) {\n        return visit.invoiced === 'pending' && visitAreCompleted(visit) && !(visitPaidStatus(visit) === 'unpaid');\n      });\n    });\n    setSelectedVisits(newSelectedVisits);\n  }\n\n  function handleClear() {\n    setFiltertext(\"\");\n    props.getServices(page, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n  }\n\n  function changeFilterText(_x4) {\n    return _changeFilterText.apply(this, arguments);\n  }\n\n  function _changeFilterText() {\n    _changeFilterText = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(e) {\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              setFiltertext(e.target.value);\n\n            case 1:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n    return _changeFilterText.apply(this, arguments);\n  }\n\n  var ExpandedComponent = function ExpandedComponent(_ref2) {\n    var data = _ref2.data;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: _this2,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 7\n      }\n    }, data.visits.length === 0 && /*#__PURE__*/React.createElement(Skeleton, {\n      __self: _this2,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 40\n      }\n    }) || /*#__PURE__*/React.createElement(VisitDetail, {\n      key: \"visitDetail-\".concat(data.id),\n      selectedService: selectedRows,\n      setSelectedService: setSelectedRows,\n      setSelectedVisits: setSelectedVisits,\n      selectedVisits: selectedVisits,\n      service: data,\n      __self: _this2,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 11\n      }\n    }));\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    id: \"finance-table\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Accordion, {\n    defaultExpanded: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 359,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(AccordionDetails, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    spacing: 3,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 362,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(ModalConfirmation, {\n    selectedVisits: selectedVisits,\n    showModal: showModalConfirmation,\n    setShowModal: setShowModalConfirmation,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 363,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(ModalDownloadConfirmation, {\n    dateRange: dateRange,\n    showModal: showModalDownloadConfirmation,\n    setShowModal: setShowModalDownloadConfirmation,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(MaterialTable, {\n    title: i18next.t('sideNavBar.finances'),\n    columns: service_columns,\n    data: props.services,\n    progressPending: servicesLoading,\n    selectableRowDisabled: rowDisabledCriteria,\n    selectableRows: true,\n    selectableRowsComponent: Checkbox,\n    selectableRowsComponentProps: {\n      className: \"product-checkbox\",\n      color: \"primary\"\n    },\n    progressComponent: /*#__PURE__*/React.createElement(CircularProgress, {\n      size: 50,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 374,\n        columnNumber: 36\n      }\n    }),\n    onSelectedRowsChange: handleRowChange,\n    pagination: true,\n    paginationServer: true,\n    responsive: true,\n    paginationTotalRows: props.total,\n    onChangeRowsPerPage: handlePerRowsChange,\n    onChangePage: handlePageChange,\n    highlightOnHover: true,\n    striped: true,\n    noDataComponent: i18next.t('globalText.NoDataComponent'),\n    paginationComponentOptions: {\n      rowsPerPageText: i18next.t('globalText.rowsPerPageText'),\n      rangeSeparatorText: i18next.t('globalText.rangeSeparatorText'),\n      noRowsPerPage: false,\n      selectAllRowsItem: false,\n      selectAllRowsItemText: i18next.t('globalText.selectAllRowsItemText')\n    },\n    noHeader: true,\n    subHeader: true,\n    subHeaderComponent: /*#__PURE__*/React.createElement(FilterComponent, {\n      setServicesLoading: setServicesLoading,\n      getServices: props.getServices,\n      setShowModalConfirmation: setShowModalConfirmation,\n      selectedVisits: selectedVisits,\n      open: open,\n      toggle: toggle,\n      dateRange: dateRange,\n      setDateRange: setDateRange,\n      setOpen: setOpen,\n      value: value,\n      setValue: setValue,\n      onFilter: changeFilterText,\n      onClear: handleClear,\n      filterText: filterText,\n      setShowModalDownloadConfirmation: setShowModalDownloadConfirmation,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 37\n      }\n    }),\n    expandableRows: true,\n    expandOnRowClicked: true,\n    expandableIcon: {\n      expanded: /*#__PURE__*/React.createElement(KeyboardArrowUp, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 45\n        }\n      }),\n      collapsed: /*#__PURE__*/React.createElement(KeyboardArrowDown, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 77\n        }\n      })\n    },\n    expandableRowsComponent: /*#__PURE__*/React.createElement(ExpandedComponent, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 42\n      }\n    }),\n    customStyles: customStyles,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 15\n    }\n  }))))));\n}\n\nFinance.propTypes = {\n  services: PropTypes.array,\n  page: PropTypes.number,\n  perPage: PropTypes.number,\n  total: PropTypes.number,\n  selectedOptions: PropTypes.object\n};\nvar structuredSelector = createStructuredSelector({\n  services: function services(state) {\n    return state.services;\n  },\n  total: function total(state) {\n    return state.services_total;\n  },\n  curent_user: function curent_user(state) {\n    return state.curent_user;\n  },\n  selectedOptions: function selectedOptions(state) {\n    return state.finance_selected_options;\n  }\n});\nvar mapDispatchToProps = {\n  getServices: getServices\n};\nexport default withRouter(connect(structuredSelector, mapDispatchToProps)(Finance));","map":{"version":3,"sources":["/usr/src/app/javascript/components/finance/index.jsx"],"names":["axios","React","useState","useEffect","KeyboardArrowUp","KeyboardArrowDown","ModalConfirmation","ModalDownloadConfirmation","PropTypes","connect","Link","VisitDetail","FinanceFilter","createStructuredSelector","MaterialTable","withRouter","Skeleton","toQueryParams","Checkbox","FormControl","CircularProgress","Button","IconButton","InputAdornment","OutlinedInput","InputLabel","AccordionDetails","Accordion","Box","Grid","Close","DateRangePicker","visitAreCompleted","visitPaidStatus","useTranslation","i18next","GET_SERVICES_REQUEST","GET_SERVICES_SUCCESS","customStyles","subHeader","style","display","FilterComponent","setShowModalDownloadConfirmation","setServicesLoading","getServices","open","toggle","dateRange","setDateRange","setOpen","filterText","onFilter","onClear","value","setValue","selectedVisits","setShowModalConfirmation","t","range","startDate","Date","setMonth","getMonth","endDate","key","Object","keys","length","page","per_page","setLoading","queryParams","dispatch","type","clearServices","params","keywords","get","then","json","getServicesSuccess","data","error","console","log","Finance","props","servicesLoading","showModalConfirmation","showModalDownloadConfirmation","selectedRows","setSelectedRows","setSelectedVisits","setPage","perPage","setPerpage","setFiltertext","service_columns","name","selector","sortable","grow","minWidth","cell","row","number","hide","ibs_number","subcategory","customer_rut","customer_rfc","customer_id","id","rowDisabledCriteria","visits","rowValidation","service","visitPending","some","visit","invoiced","fetchData","selectedOptions","delayDebounceFn","setTimeout","clearTimeout","document","querySelectorAll","childRow","childNodes","removeChild","forEach","button","parentNode","position","right","marginTop","marginRight","handlePageChange","newPage","handlePerRowsChange","newPerPage","handleRowChange","state","newSelectedVisits","filter","handleClear","changeFilterText","e","target","ExpandedComponent","services","className","color","total","rowsPerPageText","rangeSeparatorText","noRowsPerPage","selectAllRowsItem","selectAllRowsItemText","expanded","collapsed","propTypes","array","object","structuredSelector","services_total","curent_user","finance_selected_options","mapDispatchToProps"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport React, { useState, useEffect } from 'react'\nimport { KeyboardArrowUp, KeyboardArrowDown } from '@material-ui/icons';\nimport ModalConfirmation from './modalConfirmation';\nimport ModalDownloadConfirmation from './ModalDownloadConfirmation'\nimport PropTypes from \"prop-types\"\nimport { connect } from \"react-redux\"\nimport { Link } from 'react-router-dom'\nimport VisitDetail from './VisitDetail'\nimport FinanceFilter from './FinanceFilter'\nimport { createStructuredSelector } from \"reselect\"\nimport MaterialTable from 'react-data-table-component';\nimport { withRouter } from 'react-router-dom';\nimport Skeleton from '@material-ui/lab/Skeleton';\nimport { toQueryParams } from './utils'\nimport {\n  Checkbox,\n  FormControl,\n  CircularProgress,\n  Button,\n  IconButton,\n  InputAdornment,\n  OutlinedInput,\n  InputLabel,\n  AccordionDetails,\n  Accordion,\n  Box,\n  Grid\n} from '@material-ui/core';\n\nimport Close from '@material-ui/icons/Close';\nimport 'react-date-range/dist/styles.css'; // main style file\nimport 'react-date-range/dist/theme/default.css'; // theme css file\n\nimport { DateRangePicker } from \"materialui-daterange-picker\";\nimport { visitAreCompleted, visitPaidStatus } from './utils';\nimport { useTranslation } from 'react-i18next';\nimport i18next from 'i18next';\n\nconst GET_SERVICES_REQUEST = \"GET_SERVICES_REQUEST\";\nconst GET_SERVICES_SUCCESS = \"GET_SERVICES_SUCCESS\";\n\nconst customStyles = {\n  subHeader: {\n    style: {\n      display: 'block',\n    }\n  }\n}\n\n\nconst FilterComponent = ({ setShowModalDownloadConfirmation, setServicesLoading, getServices, open, toggle, dateRange, setDateRange, setOpen, filterText, onFilter, onClear, value, setValue, selectedVisits, setShowModalConfirmation }) => (\n  <React.Fragment>\n    <Box display='flex' justifyContent='flex-end' alignItems='center' width='100%' position='relative' component='div'>\n\n      <FormControl variant=\"outlined\" className=\"custom-search\">\n        <InputLabel className=\"white-bg padding-sides-5 table-search-label\" htmlFor=\"search\">{i18next.t('globalText.filterFor')}</InputLabel>\n        <OutlinedInput\n          id=\"search\"\n          type=\"text\"\n          className=\"table-search-input\"\n          value={filterText}\n          onChange={onFilter}\n          endAdornment={\n            <InputAdornment position=\"end\" >\n              <IconButton\n                aria-label=\"toggle password visibility\"\n                onClick={onClear}\n              >\n                {<Close />}\n              </IconButton>\n            </InputAdornment>\n          }\n        />\n      </FormControl>\n      {!open &&\n\n        <Box mr={2}>\n          <Button onClick={() => { setOpen(true) }} className=\"mdl-navigation__link action-plus-btn\" variant=\"outlined\" color=\"primary\" >\n            <i className=\"material-icons\">date_range</i>&nbsp;&nbsp;\n          </Button>\n        </Box>\n      }\n      <div className='absolute-calentar'>\n        <DateRangePicker\n          open={open}\n          toggle={toggle}\n          onChange={(range) => setDateRange(range)}\n          initialDateRange={{\n            startDate: new Date(new Date().setMonth(new Date().getMonth() - 1)),\n            endDate: new Date(),\n            key: 'selection',\n          }}\n          maxDate={new Date()}\n          minDate={(new Date()).setMonth(new Date().getMonth() - 6)}\n        />\n      </div>\n      {dateRange.endDate &&\n      <Button className=\"mdl-navigation__link action-plus-btn\" onClick={() => setShowModalDownloadConfirmation(true)} variant=\"outlined\" color=\"primary\">\n          <i className=\"material-icons\">download</i>&nbsp;&nbsp;{i18next.t('services.downloadServices')}\n        </Button>\n      }\n      {!dateRange.endDate &&\n        <Button disabled className=\"mdl-navigation__link action-plus-btn\" target=\"_blank\" variant=\"outlined\" color=\"primary\" >\n          <i className=\"material-icons\">download</i>&nbsp;&nbsp;{i18next.t('services.downloadServices')}\n        </Button>\n      }\n\n      <Box ml={2}>\n        <Button onClick={() => setShowModalConfirmation(true)} disabled={!Object.keys(selectedVisits).length} variant=\"contained\" color=\"primary\">\n          {i18next.t('services.invoice')}\n        </Button>\n      </Box>\n    </Box>\n\n    <Box width='100%' marginTop={2}>\n      <FinanceFilter getServices={getServices} setServicesLoading={setServicesLoading} />\n    </Box>\n\n  </React.Fragment>\n);\n\n\nfunction getServices(page = 1, per_page = 10, filterText = \"\", setLoading, queryParams = {}) {\n  return dispatch => {\n    dispatch({ type: GET_SERVICES_REQUEST });\n    dispatch(clearServices())\n    const params = {\n      page,\n      per_page: per_page == 5 ? 10 : per_page,\n      keywords: filterText,\n      ...queryParams\n    }\n    axios.get('/api/v1/services', { params })\n      .then(json => dispatch(getServicesSuccess(json.data, setLoading)))\n      .catch(error => console.log(error))\n  };\n};\n\nexport function getServicesSuccess(json, setLoading) {\n  setLoading(false)\n  return {\n    type: GET_SERVICES_SUCCESS,\n    json\n  };\n};\nexport function clearServices() {\n  return {\n    type: GET_SERVICES_SUCCESS,\n    json: []\n  };\n};\n\n\nfunction Finance(props) {\n  const {t} = useTranslation();\n  const [value, setValue] = React.useState([new Date('2017-02-01'), new Date('2017-05-20')]);\n  const [servicesLoading, setServicesLoading] = useState(true);\n  const [showModalConfirmation, setShowModalConfirmation] = useState(false)\n  const [showModalDownloadConfirmation, setShowModalDownloadConfirmation] = useState(false)\n  const [selectedRows, setSelectedRows] = useState([]);\n  const [selectedVisits, setSelectedVisits] = useState({})\n  const [page, setPage] = useState(1);\n  const [perPage, setPerpage] = useState(10);\n  const [filterText, setFiltertext] = useState(\"\");\n  const [open, setOpen] = React.useState(false);\n  const [dateRange, setDateRange] = React.useState({\n    startDate: new Date(new Date().setMonth(new Date().getMonth() - 1)),\n    endDate: new Date(),\n    key: 'selection',\n  });\n  \n  \n  const service_columns = [\n    {\n      name: i18next.t('globalTables.serviceColumns.number'),\n      selector: 'number',\n      sortable: true,\n      grow: true,\n      minWidth: \"110px\",\n      cell: row => (\n        <span>\n          {(row.number == \"\" ? \"-\" : row.number)}\n        </span>\n      ),\n    },\n    {\n      name: i18next.t('globalTables.serviceColumns.ibsNumber'),\n      selector: 'ibs_number',\n      sortable: true,\n      hide: 'sm',\n      cell: row => (\n        <span>\n          {(!row.ibs_number ? i18next.t('globalText.noInfo'): row.ibs_number)}\n        </span>\n      ),\n    },\n    {\n      name: i18next.t('globalTables.serviceColumns.serviceType'),\n      selector: 'service_type',\n      sortable: true,\n      hide: 'md'\n    },\n    {\n      name: i18next.t('globalTables.serviceColumns.subCategory'),\n      selector: 'subcategory',\n      sortable: true,\n      hide: 'md',\n      cell: row => (\n        <span>\n          {(!row.subcategory ? i18next.t('globalText.noInfo'): row.subcategory)}\n        </span>\n      ),\n    },\n    {\n      name: i18next.t('globalTables.serviceColumns.customerFullName'),\n      selector: 'customer_fullname',\n      sortable: true,\n      hide: 'md'\n    },\n    {\n      name: i18next.t('globalTables.serviceColumns.statusLabel'),\n      selector: 'status_label',\n      sortable: true,\n      hide: 'md'\n    },\n    {\n      name: i18next.t('globalTables.serviceColumns.identifier'),\n      selector: 'customer_rut',\n      sortable: true,\n      hide: 'md',\n      cell: row => (\n        <span>\n          {(!row.customer_rut ? row.customer_rfc : row.customer_rut)}\n        </span>\n      ),\n  \n    },\n    {\n      name: i18next.t('globalTables.serviceColumns.actions'),\n      selector: 'id',\n      grow: true,\n      minWidth: \"120px\",\n      cell: row => (\n        <div>\n          <Link className=\"mdl-navigation__link brand-primary-link customers-show-link services-show-link mg-r-15\" to={`/customers/${row.customer_id}/services/${row.id}/edit_service`}>\n            <i className=\"material-icons material-icons-20\">assignment</i> {i18next.t('globalText.details')}\n          </Link>\n        </div>\n      ),\n    },\n    {\n      name: '',\n      grow: true,\n      minWidth: \"1px\",\n      cell: row => (\n        <span></span>\n      ),\n    },\n  \n  ];\n\n  const rowDisabledCriteria = row => row.visits.length === 0 || rowValidation(row)\n\n  function rowValidation(service) {\n    const visitPending = service.visits.some(visit => (visit.invoiced === 'pending') && visitAreCompleted(visit) && (visitPaidStatus(visit) === 'paid' || visitPaidStatus(visit) == 'unrequired'))\n    return !visitPending\n  }\n\n  const toggle = () => setOpen(!open);\n\n  useEffect(() => {\n    async function fetchData() {\n      setServicesLoading(true);\n      props.getServices(page, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n    }\n    fetchData();\n  }, []);\n\n  useEffect(() => {\n    return () => {\n      setServicesLoading(true);\n      const delayDebounceFn = setTimeout(() => {\n        props.getServices(page, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n      }, 1000)\n      return () => clearTimeout(delayDebounceFn)\n\n    }\n  }, [filterText])\n\n  useEffect(() => {\n    setTimeout(() => {\n      const row = document.querySelectorAll('[role=\"row\"]')[0]\n      const childRow = row.childNodes[1]\n      row.removeChild(childRow)\n\n      document.querySelectorAll('[aria-label=\"Expand Row\"]').forEach(button => {\n        button.parentNode.style.position = 'absolute'\n        button.parentNode.style.right = 0\n        button.parentNode.style.marginTop = '6px'\n        button.parentNode.style.marginRight = '8px'\n      })\n    }, 200)\n\n  }, [servicesLoading])\n\n  async function handlePageChange(newPage) {\n    setServicesLoading(true);\n    props.getServices(newPage, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n  }\n\n  async function handlePerRowsChange(newPerPage, newPage) {\n    setServicesLoading(true);\n    props.getServices(newPage, newPerPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n    setPerpage(newPerPage);\n  }\n\n  function handleRowChange(state) {\n    setSelectedRows(state.selectedRows);\n    const newSelectedVisits = {}\n\n    state.selectedRows.forEach(service => {\n      newSelectedVisits[service.id] = service.visits.filter(visit => visit.invoiced === 'pending' && visitAreCompleted(visit) && !(visitPaidStatus(visit) === 'unpaid'))\n    })\n\n    setSelectedVisits(newSelectedVisits)\n  }\n\n  function handleClear() {\n    setFiltertext(\"\");\n    props.getServices(page, perPage, filterText, setServicesLoading, toQueryParams(props.selectedOptions));\n  }\n\n  async function changeFilterText(e) {\n    setFiltertext(e.target.value);\n  }\n\n  const ExpandedComponent = ({ data }) => {\n    return (\n      <div>\n        {\n          (data.visits.length === 0 && <Skeleton />)\n          ||\n          <VisitDetail\n            key={`visitDetail-${data.id}`}\n            selectedService={selectedRows}\n            setSelectedService={setSelectedRows}\n            setSelectedVisits={setSelectedVisits}\n            selectedVisits={selectedVisits}\n            service={data}\n          />\n        }\n      </div>\n    )\n  }\n\n  return (\n    <div id='finance-table'>\n      <Accordion defaultExpanded>\n        <AccordionDetails>\n          <Grid container spacing={3}>\n            <Grid item xs={12}>\n              <ModalConfirmation selectedVisits={selectedVisits} showModal={showModalConfirmation} setShowModal={setShowModalConfirmation} />\n              <ModalDownloadConfirmation dateRange={dateRange} showModal={showModalDownloadConfirmation} setShowModal={setShowModalDownloadConfirmation} />\n              <MaterialTable\n                title={i18next.t('sideNavBar.finances')}\n                columns={service_columns}\n                data={props.services}\n                progressPending={servicesLoading}\n                selectableRowDisabled={rowDisabledCriteria}\n                selectableRows\n                selectableRowsComponent={Checkbox}\n                selectableRowsComponentProps={{ className: \"product-checkbox\", color: \"primary\" }}\n                progressComponent={<CircularProgress size={50} />}\n                onSelectedRowsChange={handleRowChange}\n                pagination\n                paginationServer\n                responsive={true}\n                paginationTotalRows={props.total}\n                onChangeRowsPerPage={handlePerRowsChange}\n                onChangePage={handlePageChange}\n                highlightOnHover={true}\n                striped={true}\n                noDataComponent={i18next.t('globalText.NoDataComponent')}\n                paginationComponentOptions={{rowsPerPageText: i18next.t('globalText.rowsPerPageText'), rangeSeparatorText: i18next.t('globalText.rangeSeparatorText'), noRowsPerPage: false, selectAllRowsItem: false, selectAllRowsItemText: i18next.t('globalText.selectAllRowsItemText') }}\n                noHeader={true}\n                subHeader\n\n\n                subHeaderComponent={<FilterComponent setServicesLoading={setServicesLoading} getServices={props.getServices} setShowModalConfirmation={setShowModalConfirmation} selectedVisits={selectedVisits} open={open} toggle={toggle} dateRange={dateRange} setDateRange={setDateRange} setOpen={setOpen} value={value} setValue={setValue} onFilter={changeFilterText} onClear={handleClear} filterText={filterText} setShowModalDownloadConfirmation={setShowModalDownloadConfirmation}/>}\n                expandableRows={true}\n                expandOnRowClicked={true}\n                expandableIcon={{ expanded: <KeyboardArrowUp />, collapsed: <KeyboardArrowDown /> }}\n                expandableRowsComponent={<ExpandedComponent />}\n                customStyles={customStyles}\n              />\n            </Grid>\n          </Grid>\n        </AccordionDetails>\n      </Accordion>\n    </div>\n  );\n}\n\nFinance.propTypes = {\n  services: PropTypes.array,\n  page: PropTypes.number,\n  perPage: PropTypes.number,\n  total: PropTypes.number,\n  selectedOptions: PropTypes.object,\n};\n\nconst structuredSelector = createStructuredSelector({\n  services: state => state.services,\n  total: state => state.services_total,\n  curent_user: state => state.curent_user,\n  selectedOptions: state => state.finance_selected_options\n});\nconst mapDispatchToProps = { getServices };\nexport default withRouter(connect(structuredSelector, mapDispatchToProps)(Finance));\n"]},"metadata":{},"sourceType":"module"}