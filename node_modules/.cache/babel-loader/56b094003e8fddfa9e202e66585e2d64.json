{"ast":null,"code":"var _jsxFileName = \"/usr/src/app/javascript/components/services/visits/VisitPayments.jsx\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr == null ? null : typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]; if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { connect } from \"react-redux\";\nimport { createStructuredSelector } from \"reselect\";\nimport { flash_alert } from 'components/App';\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport VisitPaymentDetail from \"components/services/visits/VisitPaymentDetail\";\n\nfunction VisitPayments(props) {\n  var useStyles = makeStyles(function (theme) {\n    return createStyles({\n      previewChip: {\n        minWidth: 160,\n        maxWidth: 210\n      },\n      wrapper: {\n        margin: theme.spacing(1),\n        position: 'relative'\n      },\n      buttonProgress: {\n        position: 'absolute',\n        top: '50%',\n        left: '50%',\n        marginTop: -12,\n        marginLeft: -12\n      }\n    });\n  });\n  var classes = useStyles();\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      paymentData = _useState2[0],\n      setPaymentData = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      customer = _useState4[0],\n      setCustomer = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  var _useState7 = useState(\"\"),\n      _useState8 = _slicedToArray(_useState7, 2),\n      paymentDate = _useState8[0],\n      setPaymentDate = _useState8[1];\n\n  var _useState9 = useState(\"\"),\n      _useState10 = _slicedToArray(_useState9, 2),\n      paymentTime = _useState10[0],\n      setPaymentTime = _useState10[1];\n\n  var _useState11 = useState(),\n      _useState12 = _slicedToArray(_useState11, 2),\n      paymentType = _useState12[0],\n      setPaymentType = _useState12[1];\n\n  var _useState13 = useState(\"\"),\n      _useState14 = _slicedToArray(_useState13, 2),\n      zipCode = _useState14[0],\n      setZipCode = _useState14[1];\n\n  useEffect(function () {\n    if (props.visit) {\n      fetchVisitsPayments(props.visit.id, \"Visita\", props.visit.service_id);\n    }\n  }, []);\n\n  function fetchVisitsPayments(_x, _x2) {\n    return _fetchVisitsPayments.apply(this, arguments);\n  }\n\n  function _fetchVisitsPayments() {\n    _fetchVisitsPayments = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(object_id, object_class) {\n      var service_id,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              service_id = _args.length > 2 && _args[2] !== undefined ? _args[2] : null;\n              setLoading(true);\n              console.log(\"object_id: \" + object_id);\n              console.log(\"object_class:_ \" + object_class);\n              return _context.abrupt(\"return\", fetch(\"/api/v1/payments?object_id=\".concat(object_id, \"&object_class=\").concat(object_class, \"&service_id=\").concat(service_id)).then(function (response) {\n                return response.json();\n              }).then(function (json) {\n                if (json.data) {\n                  setPaymentData(json.data);\n\n                  if (json.data[0] != undefined) {\n                    console.log(\"json.data[0]\");\n                    console.log(json.data[0]);\n                    var payment_date = json.data[0].created_at; //test[7].split('=>')\n\n                    //test[7].split('=>')\n                    payment_date = payment_date.split(\"-\");\n                    var payment_time = json.data[0].created_at.split(\":\");\n                    setPaymentTime(payment_time[0].split(\"T\")[1] + \":\" + payment_time[1] + \":\" + payment_time[2].split(\".\")[0]);\n                    setPaymentDate(payment_date[1] + \"/\" + payment_date[2].substr(0, 2) + \"/\" + payment_date[0]);\n                    var test = json.data[0].provider_params && json.data[0].provider_params.split(',') || null;\n\n                    if (json.data[0].payment_method_id == 1) {\n                      //WEBPAY\n                      var payment_type_code = test[9].split('=>');\n\n                      if (payment_type_code[1] == '\"VD\"') {\n                        setPaymentType(\"Débito\");\n                      } else {\n                        var installments_number = test[12].split('=>');\n                        setPaymentType(\"Cŕedito - \" + installments_number[1].substr(0, installments_number[1].length - 1) + \" cuotas\");\n                      }\n                    }\n\n                    fetchCustomer(json.data[0].customer_id);\n                  } else {\n                    fetchCustomer(props.customerID);\n                  }\n                } else {\n                  console.log(\"No hay precio.\");\n                }\n\n                setLoading(false);\n              })[\"catch\"](function (error) {\n                return console.log(error) && setLoading(false);\n              }));\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _fetchVisitsPayments.apply(this, arguments);\n  }\n\n  function fetchCustomer(_x3) {\n    return _fetchCustomer.apply(this, arguments);\n  }\n\n  function _fetchCustomer() {\n    _fetchCustomer = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(customer_id) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setLoading(true);\n              return _context2.abrupt(\"return\", fetch(\"/api/v1/customers/\".concat(customer_id)).then(function (response) {\n                return response.json();\n              }).then(function (json) {\n                if (json.data) {\n                  setCustomer(json.data);\n                  console.log(\"json.data customer: \");\n                  console.log(json.data);\n                  setZipCode(json.data.zipcode);\n                } else {\n                  console.log(\"No se encontró el cliente\");\n                }\n\n                setLoading(false);\n              })[\"catch\"](function (error) {\n                return console.log(error) && setLoading(false);\n              }));\n\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _fetchCustomer.apply(this, arguments);\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 3\n    }\n  }, loading && /*#__PURE__*/React.createElement(CircularProgress, {\n    size: 24,\n    className: classes.buttonProgress,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 29\n    }\n  }), paymentData.length > 0 && /*#__PURE__*/React.createElement(VisitPaymentDetail, {\n    subcategory: props.subcategory,\n    paymentType: paymentType,\n    paymentDate: paymentDate,\n    paymentTime: paymentTime,\n    customer: customer,\n    loading: loading,\n    setLoading: setLoading,\n    classes: classes,\n    service_type: props.service_type,\n    paymentData: paymentData,\n    visit: props.visit,\n    paymentChannel: props.paymentChannel,\n    country: props.country,\n    noPaymentCheck: props.visit.no_payment == null ? props.noPaymentCheck : props.visit.no_payment,\n    noPaymentOption: props.noPaymentOption,\n    validated_payment: props.validated_payment,\n    invoiceCheck: props.invoiceCheck,\n    selectedConsumables: props.selectedConsumables,\n    paymentFiles: props.paymentFiles // Totals\n    ,\n    selectedPaymentDate: props.selectedPaymentDate,\n    customerPaymentDate: props.customerPaymentDate,\n    totalhours: props.totalhours,\n    hourAmout: props.hourAmout,\n    feeAmount: props.feeAmount,\n    laborAmount: props.laborAmount,\n    consumableAmount: props.consumableAmount,\n    viaticAmout: props.viaticAmout,\n    ivaAmount: props.ivaAmount,\n    subtotalAmount: props.subtotalAmount,\n    totalAmount: props.totalAmount // Bill address\n    ,\n    zipcode_fn: props.zipcode_fn,\n    state_fn: props.state_fn,\n    delegation_fn: props.delegation_fn,\n    colony_fn: props.colony_fn,\n    street_type_fn: props.street_type_fn,\n    street_name_fn: props.street_name_fn,\n    ext_number_fn: props.ext_number_fn,\n    int_number_fn: props.int_number_fn,\n    phone_fn: props.phone_fn,\n    administrative_demarcation_fn: props.administrative_demarcation_fn //callbacks\n    ,\n    callbacks: props.callbacks,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 21\n    }\n  }) || /*#__PURE__*/React.createElement(VisitPaymentDetail, {\n    subcategory: props.subcategory,\n    paymentType: paymentType,\n    paymentDate: paymentDate,\n    paymentTime: paymentTime,\n    customer: customer,\n    loading: loading,\n    setLoading: setLoading,\n    classes: classes,\n    service_type: props.service_type,\n    paymentData: paymentData,\n    visit: props.visit,\n    paymentChannel: props.paymentChannel,\n    country: props.country,\n    noPaymentCheck: props.visit.no_payment == null ? props.noPaymentCheck : props.visit.no_payment,\n    noPaymentOption: props.noPaymentOption,\n    validated_payment: props.validated_payment,\n    invoiceCheck: props.invoiceCheck,\n    selectedConsumables: props.selectedConsumables,\n    paymentFiles: props.paymentFiles // Totals\n    ,\n    selectedPaymentDate: props.selectedPaymentDate,\n    customerPaymentDate: props.customerPaymentDate,\n    totalhours: props.totalhours,\n    hourAmout: props.hourAmout,\n    feeAmount: props.feeAmount,\n    laborAmount: props.laborAmount,\n    consumableAmount: props.consumableAmount,\n    viaticAmout: props.viaticAmout,\n    ivaAmount: props.ivaAmount,\n    subtotalAmount: props.subtotalAmount,\n    totalAmount: props.totalAmount // Bill address\n    ,\n    zipcode_fn: props.zipcode_fn,\n    zipcode: zipCode,\n    state_fn: props.state_fn,\n    delegation_fn: props.delegation_fn,\n    colony_fn: props.colony_fn,\n    street_type_fn: props.street_type_fn,\n    street_name_fn: props.street_name_fn,\n    ext_number_fn: props.ext_number_fn,\n    int_number_fn: props.int_number_fn,\n    phone_fn: props.phone_fn,\n    administrative_demarcation_fn: props.administrative_demarcation_fn //callbacks\n    ,\n    callbacks: props.callbacks,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 21\n    }\n  }));\n}\n\nvar structuredSelector = createStructuredSelector({});\nvar mapDispatchToProps = {};\nexport default connect(structuredSelector, mapDispatchToProps)(VisitPayments);","map":{"version":3,"sources":["/usr/src/app/javascript/components/services/visits/VisitPayments.jsx"],"names":["React","useState","useEffect","axios","connect","createStructuredSelector","flash_alert","createStyles","makeStyles","CircularProgress","VisitPaymentDetail","VisitPayments","props","useStyles","theme","previewChip","minWidth","maxWidth","wrapper","margin","spacing","position","buttonProgress","top","left","marginTop","marginLeft","classes","paymentData","setPaymentData","customer","setCustomer","loading","setLoading","paymentDate","setPaymentDate","paymentTime","setPaymentTime","paymentType","setPaymentType","zipCode","setZipCode","visit","fetchVisitsPayments","id","service_id","object_id","object_class","console","log","fetch","then","response","json","data","undefined","payment_date","created_at","split","payment_time","substr","test","provider_params","payment_method_id","payment_type_code","installments_number","length","fetchCustomer","customer_id","customerID","error","zipcode","subcategory","service_type","paymentChannel","country","no_payment","noPaymentCheck","noPaymentOption","validated_payment","invoiceCheck","selectedConsumables","paymentFiles","selectedPaymentDate","customerPaymentDate","totalhours","hourAmout","feeAmount","laborAmount","consumableAmount","viaticAmout","ivaAmount","subtotalAmount","totalAmount","zipcode_fn","state_fn","delegation_fn","colony_fn","street_type_fn","street_name_fn","ext_number_fn","int_number_fn","phone_fn","administrative_demarcation_fn","callbacks","structuredSelector","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { connect } from \"react-redux\"\nimport { createStructuredSelector } from \"reselect\";\nimport { flash_alert } from 'components/App';\n\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport CircularProgress from '@material-ui/core/CircularProgress';\n\nimport VisitPaymentDetail from \"components/services/visits/VisitPaymentDetail\";\n\nfunction VisitPayments(props){\n    const useStyles = makeStyles(theme => createStyles({\n\t\tpreviewChip: {\n\t\tminWidth: 160,\n\t\tmaxWidth: 210\n        },\n        wrapper: {\n            margin: theme.spacing(1),\n            position: 'relative',\n        },\n        buttonProgress: {\n            position: 'absolute',\n            top: '50%',\n            left: '50%',\n            marginTop: -12,\n            marginLeft: -12,\n        },\n    }));\n    \n    const classes = useStyles();\n    \n    const [paymentData, setPaymentData] = useState([]);\n    const [customer, setCustomer] = useState([]);\n    const [loading, setLoading] = useState(false);\n    const [paymentDate, setPaymentDate] = useState(\"\");\n    const [paymentTime, setPaymentTime] = useState(\"\");\n    const [paymentType, setPaymentType] = useState()\n    const [zipCode, setZipCode] = useState(\"\")\n\n    useEffect(() => {\n        if(props.visit){\n        fetchVisitsPayments(props.visit.id, \"Visita\", props.visit.service_id)\n        }\n    }, []);\n\n    async function fetchVisitsPayments(object_id, object_class, service_id = null){\n        setLoading(true)\n        console.log(\"object_id: \"+object_id)\n        console.log(\"object_class:_ \"+object_class)\n        return fetch(`/api/v1/payments?object_id=${object_id}&object_class=${object_class}&service_id=${service_id}`)\n        .then(response => response.json())\n        .then(json => {\n            if(json.data){\n                setPaymentData(json.data)\n                if (json.data[0] != undefined){\n                    console.log(\"json.data[0]\")\n                    console.log(json.data[0]); \n                    var payment_date = json.data[0].created_at//test[7].split('=>')\n                    payment_date = payment_date.split(\"-\")\n                    var payment_time = json.data[0].created_at.split(\":\")\n                    setPaymentTime(payment_time[0].split(\"T\")[1]+\":\" + payment_time[1] + \":\"+payment_time[2].split(\".\")[0]);\n                    setPaymentDate(payment_date[1]+\"/\"+payment_date[2].substr(0,2)  +\"/\"+payment_date[0])\n                    var test = json.data[0].provider_params && json.data[0].provider_params.split(',') || null\n                    if (json.data[0].payment_method_id == 1){//WEBPAY\n                        var payment_type_code = test[9].split('=>')\n                        if (payment_type_code[1] == '\"VD\"'){\n                            setPaymentType(\"Débito\")\n                        }\n                        else {\n                            var installments_number = test[12].split('=>')\n                            setPaymentType(\"Cŕedito - \"+installments_number[1].substr(0,installments_number[1].length-1)+ \" cuotas\")\n                        }\n                    }\n                    fetchCustomer(json.data[0].customer_id)\n                }\n                else{\n                    fetchCustomer(props.customerID)\n                }\n\n                \n            }else{\n                console.log(\"No hay precio.\")\n            }\n            setLoading(false)\n        })\n        .catch(error => console.log(error) && setLoading(false));\n    }\n\n    async function fetchCustomer(customer_id){\n        setLoading(true)\n        return fetch(`/api/v1/customers/${customer_id}`)\n        .then(response => response.json())\n        .then(json => {\n            if(json.data){\n                setCustomer(json.data)\n                console.log(\"json.data customer: \")\n                console.log(json.data)\n                setZipCode(json.data.zipcode)\n            }else{\n                console.log(\"No se encontró el cliente\")\n            }\n            setLoading(false)\n        })\n        .catch(error => console.log(error) && setLoading(false));\n    }\n\n    \n\treturn (\n\t\t<React.Fragment>\n                {loading && <CircularProgress size={24} className={classes.buttonProgress} />}\n                                        \n                {paymentData.length > 0 &&\n                    <VisitPaymentDetail\n                        subcategory={props.subcategory}\n                        paymentType = {paymentType}\n                        paymentDate = {paymentDate}\n                        paymentTime = {paymentTime}\n                        customer = {customer}\n                        loading={loading}\n                        setLoading={setLoading}\n                        classes={classes}\n                        service_type={props.service_type}\n                        paymentData={paymentData}\n                        visit={props.visit}\n                        paymentChannel={props.paymentChannel}\n                        country={props.country}\n                        noPaymentCheck={(props.visit.no_payment == null ? props.noPaymentCheck : props.visit.no_payment)}\n                        noPaymentOption={props.noPaymentOption}\n                        validated_payment={props.validated_payment}\n                        invoiceCheck={props.invoiceCheck}\n                        selectedConsumables={props.selectedConsumables}\n                        paymentFiles={props.paymentFiles}\n                        // Totals\n                        selectedPaymentDate={props.selectedPaymentDate}\n                        customerPaymentDate={props.customerPaymentDate}\n                        totalhours={props.totalhours}\n                        hourAmout={props.hourAmout}\n                        feeAmount={props.feeAmount}\n                        laborAmount={props.laborAmount}\n                        consumableAmount={props.consumableAmount}\n                        viaticAmout={props.viaticAmout}\n                        ivaAmount={props.ivaAmount}\n                        subtotalAmount={props.subtotalAmount}\n                        totalAmount={props.totalAmount}\n                        // Bill address\n                        zipcode_fn={props.zipcode_fn}\n                        state_fn={props.state_fn}\n                        delegation_fn={props.delegation_fn}\n                        colony_fn={props.colony_fn}\n                        street_type_fn={props.street_type_fn}\n                        street_name_fn={props.street_name_fn}\n                        ext_number_fn={props.ext_number_fn}\n                        int_number_fn={props.int_number_fn}\n                        phone_fn={props.phone_fn}\n                        administrative_demarcation_fn={props.administrative_demarcation_fn}\n\n                        //callbacks\n                        callbacks={props.callbacks}\n                    />\n                    ||\n                    <VisitPaymentDetail\n                        subcategory={props.subcategory}\n                        paymentType = {paymentType}\n                        paymentDate = {paymentDate}\n                        paymentTime = {paymentTime}\n                        customer = {customer}\n                        loading={loading}\n                        setLoading={setLoading}\n                        classes={classes}\n                        service_type={props.service_type}\n                        paymentData={paymentData}\n                        visit={props.visit}\n                        paymentChannel={props.paymentChannel}\n                        country={props.country}\n                        noPaymentCheck={(props.visit.no_payment == null ? props.noPaymentCheck : props.visit.no_payment)}\n                         noPaymentOption={props.noPaymentOption}\n                        validated_payment={props.validated_payment}\n                        invoiceCheck={props.invoiceCheck}\n                        selectedConsumables={props.selectedConsumables}\n                        paymentFiles={props.paymentFiles}\n                        // Totals\n                        selectedPaymentDate={props.selectedPaymentDate}\n                        customerPaymentDate={props.customerPaymentDate}\n                        totalhours={props.totalhours}\n                        hourAmout={props.hourAmout}\n                        feeAmount={props.feeAmount}\n                        laborAmount={props.laborAmount}\n                        consumableAmount={props.consumableAmount}\n                        viaticAmout={props.viaticAmout}\n                        ivaAmount={props.ivaAmount}\n                        subtotalAmount={props.subtotalAmount}\n                        totalAmount={props.totalAmount}\n                        // Bill address\n                        zipcode_fn={props.zipcode_fn}\n                        zipcode={zipCode}\n                        state_fn={props.state_fn}\n                        delegation_fn={props.delegation_fn}\n                        colony_fn={props.colony_fn}\n                        street_type_fn={props.street_type_fn}\n                        street_name_fn={props.street_name_fn}\n                        ext_number_fn={props.ext_number_fn}\n                        int_number_fn={props.int_number_fn}\n                        phone_fn={props.phone_fn}\n                        administrative_demarcation_fn={props.administrative_demarcation_fn}\n\n                        //callbacks\n                        callbacks={props.callbacks}\n                    />\n                    \n                }\n\t\t</React.Fragment>\n\t);\n  \n}\n\nconst structuredSelector = createStructuredSelector({\n});\nconst mapDispatchToProps = {};\n\nexport default connect(structuredSelector, mapDispatchToProps)(VisitPayments)\n\n"]},"metadata":{},"sourceType":"module"}